<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="R数据可视化手册-下, Shaw">
    <meta name="description" content="博主最开始正式学习 R 语言的时候，是出于数据可视化的目的，以 Oreilly 的《R数据可视化手册》 为 handbook，将此书的 90% 内容在 jupyter 中都复现了一遍。jupyter 原始文件可到我的 Github 相应仓库中获取。由于内容较多，分为了上下两部分。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>R数据可视化手册-下 | Shaw</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.0.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>



   <style>
    body{
       background-image: url(http://h2.ioliu.cn/bing/BulgariaPerseids_EN-AU11585904087_1920x1080.jpg?imageslim&quot);
       background-repeat:no-repeat;
       background-size: 100% 100%;
       background-attachment:fixed;
    }
</style>



<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Shaw</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Shaw</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/17.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">R数据可视化手册-下</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/R/">
                                <span class="chip bg-color">R</span>
                            </a>
                        
                            <a href="/tags/ggplot2/">
                                <span class="chip bg-color">ggplot2</span>
                            </a>
                        
                            <a href="/tags/handbook/">
                                <span class="chip bg-color">handbook</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/R%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E6%89%8B%E5%86%8C/" class="post-category">
                                R数据可视化手册
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-01-02
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-11-03
                </div>
                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <pre class="line-numbers language-R" data-language="R"><code class="language-R">library(ggplot2)
library(gcookbook)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h1 id="第七章-注解"><a href="#第七章-注解" class="headerlink" title="第七章 注解"></a>第七章 注解</h1><p>除了坐标轴标签、刻度线和图例这些标准的保留元素，还可以向图形添加独立的图形或文本元素。这些元素可用于增加额外的上下文信息、高亮图形的某个区域，或是补充一些关于数据的描述性文本。</p>
<h2 id="添加文本注解"><a href="#添加文本注解" class="headerlink" title="添加文本注解"></a>添加文本注解</h2><p>使用 <code>annotate()</code> 和一个文本类几何对象</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(faithful, aes(x=eruptions, y=waiting)) + geom_point()

p + annotate('text', x=3, y=48, label='Group 1', family='serif',fontface='italic',color='darkred',size=5) + 
 annotate('text', x=4.5, y=66, label='Group 2', family='serif',fontface='italic',color='darkred',size=5)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_5_0.png" alt="png"></p>
<p>当你希望添加独立的文本对象时，千万不要使用<code>geom_text()</code>。<code>annotate(geom='text')</code>会向图形添加一个单独的文本对象，而geom_text()却会根据数据创建许多的文本对象。<br>如果使用geon_text()，文本会在相同的位置被严重遮盖，每个数据点各重绘了一次：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + annotate('text', x=3, y=48, label='Group 1', alpha=.1) +  # 正常
 geom_text(x=4.5, y=66, label='Group 2', alpha=.1)  # 遮盖绘制<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_7_0.png" alt="png"></p>
<p>在上图中，每个文本标签都是90%透明的，这样就很清楚地展示出了哪一个被遮盖绘制了（geom_text被遮盖绘制）。在输出为点阵格式时，遮盖绘制问题可能会导致边缘走样（有锯齿）。</p>
<p>如果坐标轴是连续型的，你可以使用特殊值 Inf 和 -Inf 在绘图区域的边缘放置文本注解。<br>同时，也需要使用hjust和vjust来调整文本相对于边角的位置——如果你让它们留在默认值的位置上，这些文本就会居中于边界线之上。<br>要将文本定位到理想的位置，可能需要进行一些尝试：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + annotate('text', x=-Inf, y=Inf, label='Upper left', hjust=-.2, vjust=2, size=6) + 
 annotate('text', x=mean(range(faithful$eruptions)), y=-Inf, vjust=-0.4, 
         label='Bottom middle',size=6)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_10_0.png" alt="png"></p>
<h2 id="在注释中使用数学表达式"><a href="#在注释中使用数学表达式" class="headerlink" title="在注释中使用数学表达式"></a>在注释中使用数学表达式</h2><p>使用<code>annotate(geom='text')</code>并设置<code>parse=TRUE</code></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 一条正态曲线

p &lt;- ggplot(data.frame(x=c(-3,3)), aes(x=x)) + stat_function(fun = dnorm)

p + annotate('text', x=2, y=0.3, parse=TRUE,
           label='frac(1, sqrt(2 * pi)) * e ^ (-x^2 / 2)', size=8)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_13_0.png" alt="png"></p>
<p>💬<strong>讨论</strong><br>在ggplot2中使用<code>parse=TRUE</code>和文本类几何对象创建的数学表达式，和那些在R基础图形中利用 plotmath 和 expression 创建的数学表达式有着类似的格式，唯一的区别是，前者以字符串的形式存储，而后者是表达式对象。</p>
<p>要将常规文本融入表达式中，只需在双引号内使用单引号（或者反过来）标出纯文本的部分即可。<font color="red">通过内部引号闭合的每一块文本都将被作为数学表达式中的一个变量对待</font>。  </p>
<p>切记，在R的数学表达式语法中，你不能简单地把一个变量直接放到另一个变量旁边而不在中间加上任何记号。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + annotate('text', x=0, y=0.05, parse=TRUE, size=6,
            label="'Function:' * y==frac(1,sqrt(2 * pi)) * e^(-x^2/2) ")<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_15_0.png" alt="png"></p>
<p>❗ 表达式中，”=”是没有意义的，”==”才是等号的含义<br>在如上表达式中，’function’ 和 y 中间放了一个 * 操作符，它会被当作一个不可见的乘号对待（要显示一个可见的乘号，需要使用%*%）.</p>
<h2 id="添加直线"><a href="#添加直线" class="headerlink" title="添加直线"></a>添加直线</h2><p>对于横线和竖线，使用 <code>geom_hline()</code> 和 <code>geom_vline()</code>即可。对于有角度的直线，则可以使用geom_abline()。对于下例，我们将使用 heightweight 数据集：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(heightweight, aes(x=ageYear, y=heightIn, color=sex)) + geom_point()

# 添加横线和竖线
p + geom_hline(yintercept = 60) + geom_vline(xintercept = 14)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_19_0.png" alt="png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 添加有角度的直线
p + geom_abline(intercept = 37.4, slope = 1.75)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_20_0.png" alt="png"></p>
<p>上例演示了手动设置直线位置的方法，效果是每添加一个几何对象绘制一条线。我们也可以将值从数据映射到xintercept、yintercept等之上，甚至是绘制另一个数据框中的值</p>
<p>我们将在这里计算男性和女性的平均身高，并将它们存储到一个数据框hw_means中。然后为每个均值绘制一条水平线，并手工设定linetype和size：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(plyr) # 为了使用ddply()函数<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">hw_means &lt;- ddply(heightweight, 'sex', summarise, heightIn=mean(heightIn))
hw_means<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 2</caption>
<thead>
    <tr><th scope="col">sex</th><th scope="col">heightIn</th></tr>
    <tr><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>f</td><td>60.52613</td></tr>
    <tr><td>m</td><td>62.06000</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + geom_hline(aes(yintercept=heightIn,color=sex), data=hw_means,
              linetype='dashed', size=1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_25_0.png" alt="png"></p>
<p>如果某个坐标轴是离散型而不是连续型的，不能以字符串的形式直接指定截距——必须仍以数字的形式指定它们。<br>假设此坐标轴表示一个因子，那么第一个水平为数值1，第二个水平为数值2，依次类推。可以像下面这种手工指定数值型的截距，或者使用which(levels(…))计算所需数值：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">pg &lt;- ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_point()

pg + geom_vline(xintercept = 2)

pg + geom_vline(xintercept = which(levels(PlantGrowth$group)=='ctrl'))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_27_0.png" alt="png"></p>
<p><img src="output_27_1.png" alt="png"></p>
<h2 id="添加线段和箭头"><a href="#添加线段和箭头" class="headerlink" title="添加线段和箭头"></a>添加线段和箭头</h2><p>使用<code>annotate('segment')</code></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">options(repr.plot.width=8, repr.plot.height=4)
p &lt;- ggplot(subset(climate, Source=='Berkeley'), aes(x=Year, y=Anomaly10y)) + 
 geom_line()

p + annotate('segment', x=1950, xend=1980,y=-.25, yend = -.25)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_30_0.png" alt="png"></p>
<p>可以使用 grid 包中的<code>arrow()</code>函数向线段两端添加箭头或平头</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(grid)
p + annotate('segment', x = 1850, xend = 1820, y = -.8, yend = -.95, color = 'blue', size = 1, arrow=arrow(length = unit(.3, 'cm'))) + 
    annotate('segment', x=1950, xend=1980,y=-.25, yend = -.25,
            arrow=arrow(ends = 'both', angle = 90, length = unit(.2, 'cm')))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_32_0.png" alt="png"></p>
<p>箭头线的默认角度（angle）为30度，默认长度（length）为0.2英寸（0.508厘米）。如果一个或多个坐标轴是离散型的，则 x 和 y 的位置即由拥有坐标值1,2,3等的类别项表示。</p>
<h2 id="添加矩形阴影"><a href="#添加矩形阴影" class="headerlink" title="添加矩形阴影"></a>添加矩形阴影</h2><p>💡 使用<code>annotate('rect')</code></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(subset(climate, Source=='Berkeley'), aes(x=Year, y=Anomaly10y)) + 
        geom_line()

p + annotate('rect', xmin = 1950, xmax = 1980, ymin = -1, ymax = 1, alpha = .1, fill = 'blue')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_36_0.png" alt="png"></p>
<p>💬<strong>讨论</strong><br>每一个图层都是按照添加到ggplot对象的先后顺序绘制的。  </p>
<p>只要传递了合适的参数，任意几何对象都是可以配合<code>annotate()</code>使用。在本例中，<code>geom_rect()</code>所需的参数是 x 和 y 的最大值和最小值。</p>
<h2 id="高亮某一元素"><a href="#高亮某一元素" class="headerlink" title="高亮某一元素"></a>高亮某一元素</h2><p>要高亮一个或多个元素，需要在数据中创建一个新列并将其映射为颜色。在本例中，我们将创建一个新列 h1， 并根据 group 的值来设定它的值：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">pg &lt;- PlantGrowth
pg$h1 &lt;- 'no'
pg$h1[pg$group=='trt2'] &lt;- 'yes'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">options(repr.plot.width=7, repr.plot.height=7)
ggplot(pg, aes(x=group, y=weight, fill=h1)) + geom_boxplot() + 
 scale_fill_manual(values = c('grey85', '#FFDDCC'), guide='none')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_41_0.png" alt="png"></p>
<h2 id="添加误差线"><a href="#添加误差线" class="headerlink" title="添加误差线"></a>添加误差线</h2><p>使用<code>geom_errorbar()</code>并将变量映射到 ymin 和 ymax（当横向作图时，为 xmin 和 xmax）。对于条形图和折线图，添加误差线的方法相同。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ce &lt;- subset(cabbage_exp, Cultivar == 'c39')
head(ce,2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 6</caption>
<thead>
    <tr><th></th><th scope="col">Cultivar</th><th scope="col">Date</th><th scope="col">Weight</th><th scope="col">sd</th><th scope="col">n</th><th scope="col">se</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>c39</td><td>d16</td><td>3.18</td><td>0.9566144</td><td>10</td><td>0.30250803</td></tr>
    <tr><th scope="row">2</th><td>c39</td><td>d20</td><td>2.80</td><td>0.2788867</td><td>10</td><td>0.08819171</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 为条形图添加误差线
ggplot(ce, aes(x=Date, y=Weight)) + 
 geom_bar(fill='white', color='black', stat = 'identity', width = 0.5) + 
 geom_errorbar(aes(ymin=Weight - se, ymax=Weight + se), width = 0.15, size = 1)

# 为折线图添加误差线
ggplot(ce, aes(x=Date, y=Weight)) + 
 geom_line(aes(group=1)) + 
 geom_point(size = 4) + 
 geom_errorbar(aes(ymin=Weight - se, ymax=Weight + se), width = 0.15, size = 1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_45_0.png" alt="png"></p>
<p><img src="output_45_1.png" alt="png"></p>
<p>关于 <code>geom_line()</code>中设置group，可参见<a href="#%E7%BB%98%E5%88%B6%E7%AE%80%E5%8D%95%E6%8A%98%E7%BA%BF%E5%9B%BE">第四章折线图</a></p>
<p>💬<strong>讨论</strong><br>对于一幅分组的条形图，各误差线也必须被并列（dodged）；（参见<a href="#%E7%BB%98%E5%88%B6%E7%B0%87%E7%8A%B6%E6%9D%A1%E5%BD%A2%E5%9B%BE">绘制簇状条形图</a>以了解关于分组条形图和并列的更多信息）。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(cabbage_exp, 2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 6</caption>
<thead>
    <tr><th></th><th scope="col">Cultivar</th><th scope="col">Date</th><th scope="col">Weight</th><th scope="col">sd</th><th scope="col">n</th><th scope="col">se</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>c39</td><td>d16</td><td>3.18</td><td>0.9566144</td><td>10</td><td>0.30250803</td></tr>
    <tr><th scope="row">2</th><td>c39</td><td>d20</td><td>2.80</td><td>0.2788867</td><td>10</td><td>0.08819171</td></tr>
</tbody>
</table>



<p><code>geom_bar()</code>的默认并列宽度为0.9，必须让误差线的并列宽度与此相同。如果不指定并列宽度，则默认按误差线的宽度并列，而此宽度通常小于条形的宽度：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 反例：未指定并列宽度
ggplot(cabbage_exp, aes(x=Date, y=Weight, fill=Cultivar)) + 
 geom_bar(position = 'dodge', stat = 'identity') + 
 geom_errorbar(aes(ymin=Weight-se, ymax=Weight+se),
              position='dodge', width=0.2)

# 正例：设定列宽与条形的相同
ggplot(cabbage_exp, aes(x=Date, y=Weight, fill=Cultivar)) + 
 geom_bar(position = 'dodge', stat = 'identity', width = 0.6) + 
 geom_errorbar(aes(ymin=Weight-se, ymax=Weight+se),
              position=position_dodge(0.6), width=0.2, )<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_50_0.png" alt="png"></p>
<p><img src="output_50_1.png" alt="png"></p>
<p>对于折线图和点图，应 先绘制误差线，这样它们就会位于点和线的下层。</p>
<p>应当同时并列所有的几何元素，这样它们就会同误差线对齐。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">pd &lt;- position_dodge(.3) # 保存并列设置，因为我们要重复使用

ggplot(cabbage_exp, aes(x=Date, y=Weight, color=Cultivar, group=Cultivar)) + 
 geom_errorbar(aes(ymin=Weight-se, ymax=Weight+se), position = pd, width=0.2, color = 'black') + 
 geom_line(position = pd) + 
 geom_point(position = pd, size = 2.5)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_53_0.png" alt="png"></p>
<p>通过将 Cultivar 映射到 group 的方式来确保它被作为分组变量使用。<br>当一个离散型变量被映射到一个如 color 或 fill 的图形属性时，此变量就会被用于对数据进行分组。</p>
<h3 id="添加误差线实例"><a href="#添加误差线实例" class="headerlink" title="添加误差线实例"></a>添加误差线实例</h3><pre class="line-numbers language-R" data-language="R"><code class="language-R">condition &lt;- c(rep('wt1',3), rep('MutL',3), rep('ΔL',3), rep('blank',3), rep('wt2',3), rep('ΔupL',3), rep('ΔlowL',3), rep('A1c',3))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">value &lt;- c(1.00, 1.03, 0.96, 0.47, 0.51, 0.50, 0.60, 0.56, 0.57, rep(0,3),0.97, 1.02, 1.00, 0.24, 0.27, 0.25, 0.23, 0.25, 0.23, 0.11, 0.12, 0.10)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">df &lt;- data.frame(condition, value)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">ord &lt;- unique(df$condition)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">ord<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'wt1'</li><li>'MutL'</li><li>'ΔL'</li><li>'blank'</li><li>'wt2'</li><li>'ΔupL'</li><li>'ΔlowL'</li><li>'A1c'</li></ol>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">mean_df &lt;- as.data.frame(tapply(df$value, df$condition, FUN = mean))  #得到平均值
means &lt;- mean_df[ord,] # 按condition的顺序取平均值

sd_df &lt;- as.data.frame(tapply(df$value, df$condition, FUN = sd))
sds &lt;- sd_df[ord,]

mean_col &lt;- rep(means,rep(3,length(means))) # 重复平均值用于做新列
sd_col &lt;- rep(sds,rep(3,length(sds)))

df$mean &lt;- mean_col
df$sd &lt;- sd_col<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">df$condition &lt;- factor(condition,levels = rev(ord)) # 设定condition 的 level 顺序<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">#pdf(file='LH_plot.pdf')
ggplot(df, aes(x=condition)) + 
 theme_classic(base_size = 25) +
 geom_bar(mapping = aes(y = mean) ,color=NA, fill="GoldEnrod",width = 0.4, stat = 'summary') + 
 geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd),width=0.4, size = 1.5) +
 geom_point(aes(x=factor(condition), y = mean),size=2.5, position = position_jitter(width = 0.26)) + 
 theme(axis.text.y = element_text(hjust = 1,family = 'sans', face = 'bold.italic')) + 
 coord_flip() + 
 scale_y_continuous(position = 'right', expand = c(0,0.0)) + 
 labs(x= '', y = '') + 
 theme(axis.ticks.y = element_blank())<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre><code>No summary function supplied, defaulting to `mean_se()`
</code></pre>
<p><img src="output_63_1.png" alt="png"></p>
<h2 id="向独立分面添加注解"><a href="#向独立分面添加注解" class="headerlink" title="向独立分面添加注解"></a>向独立分面添加注解</h2><p>使用分面变量创建一个新的数据框，并设定每个分面要绘制的值。然后配合新数据框使用<code>geom_text()</code>:</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(mpg, 2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A tibble: 2 × 11</caption>
<thead>
    <tr><th scope="col">manufacturer</th><th scope="col">model</th><th scope="col">displ</th><th scope="col">year</th><th scope="col">cyl</th><th scope="col">trans</th><th scope="col">drv</th><th scope="col">cty</th><th scope="col">hwy</th><th scope="col">fl</th><th scope="col">class</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th></tr>
</thead>
<tbody>
    <tr><td>audi</td><td>a4</td><td>1.8</td><td>1999</td><td>4</td><td>auto(l5)  </td><td>f</td><td>18</td><td>29</td><td>p</td><td>compact</td></tr>
    <tr><td>audi</td><td>a4</td><td>1.8</td><td>1999</td><td>4</td><td>manual(m5)</td><td>f</td><td>21</td><td>29</td><td>p</td><td>compact</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">options(repr.plot.width=8, repr.plot.height=4)
# 基本图形
p &lt;- ggplot(mpg, aes(x=displ, y=hwy)) + geom_point() + facet_grid(. ~ drv) 

# 存有每个分面所需要标签的数据框
f_labels &lt;- data.frame(drv = c('4', 'f', 'r'), label = c('4wd', 'Front', 'Rear'))

p + geom_text(x=6, y=40, aes(label=label), data = f_labels)

# 如果你使用annotate(), 标签将在所有分面上出现
p + annotate('text',x=6, y=42, label='label text')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_67_0.png" alt="png"></p>
<p><img src="output_67_1.png" alt="png"></p>
<h1 id="第八章-坐标轴"><a href="#第八章-坐标轴" class="headerlink" title="第八章 坐标轴"></a>第八章 坐标轴</h1><h2 id="交换x轴和y轴"><a href="#交换x轴和y轴" class="headerlink" title="交换x轴和y轴"></a>交换x轴和y轴</h2><p>使用coord_flip()来翻转坐标轴：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_boxplot()

ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_boxplot() + coord_flip()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_71_0.png" alt="png"></p>
<p><img src="output_71_1.png" alt="png"></p>
<p>对于散点图来说，调换纵轴和横轴上显示的元素非常简单：仅仅交换映射到 x 和 y 的变量就可以了。但并不是所有 ggplot2 中的几何对象都会同等对待 x轴 和 y轴。<br>举例来说，箱线图依 y 轴对数据计算统计摘要，折线图中的线段只沿 x 轴移动，误差线只有一个单独的 x 值但具有若干 y 值，等等。如果你正在使用这些几何对象，并且希望在图形中交换它们的坐标轴，那么 <code>coord_flip()</code> 正是你所需要的。  </p>
<p>有时在交换坐标轴后，各项的顺序可能正好与你想要的相反。如果 x 变量是一各 factor 变量，则排列顺序可以通过使用<code>scale_x_distance()</code>和参数 <code>limit=rev(levels(...))</code>进行反转，</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_boxplot() + coord_flip() + 
 scale_x_discrete(limits=rev(levels(PlantGrowth$group)))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_73_0.png" alt="png"></p>
<h2 id="设置连续型坐标轴的值域"><a href="#设置连续型坐标轴的值域" class="headerlink" title="设置连续型坐标轴的值域"></a>设置连续型坐标轴的值域</h2><p>可以使用<code>xlim()</code>或<code>ylim()</code>来设置一条连续型坐标轴的最小值和最大值。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(PlantGrowth, 2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 2</caption>
<thead>
    <tr><th></th><th scope="col">weight</th><th scope="col">group</th></tr>
    <tr><th></th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>4.17</td><td>ctrl</td></tr>
    <tr><th scope="row">2</th><td>5.58</td><td>ctrl</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_boxplot()

p + ylim(0, max(PlantGrowth$weight))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_77_0.png" alt="png"></p>
<p>💬<strong>讨论</strong><br>使用<code>ylim()</code>来设定范围是通过<code>scale_y_continuous()</code>来设定范围的简便写法。一下两种表达方式等价：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ylim(0, 10)
scale_y_continuous(limits = c(0, 10))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre><code>&lt;ScaleContinuousPosition&gt;
 Range:  
 Limits:    0 --   10



&lt;ScaleContinuousPosition&gt;
 Range:  
 Limits:    0 --   10
</code></pre>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + scale_y_continuous(limits = c(0, 10), breaks = c(0, 5, 10))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_80_0.png" alt="png"></p>
<p>ggplot2中有两种设置坐标轴值域的方式。第一种是修改标度，第二种是应用一个坐标变换。<br>当你修改x标度和y标度的范围时，任何在范围以外的数据都会被移除——换言之，超出范围的数据不仅不会被展示，而且会被完全移出考虑处理的数据范围。  </p>
<p>以上箱线图为例，如果你限制了 y 的值域，使得某些原始数据被剪掉，则箱线图中统计量的计算都会基于修剪后的数据，而箱线的形状也会随之改变</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + scale_y_continuous(limits = c(5.0, 6.5))
p + coord_cartesian(ylim = c(5.0, 6.5))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre><code>Warning message:
"Removed 13 rows containing non-finite values (stat_boxplot)."
</code></pre>
<p><img src="output_83_1.png" alt="png"></p>
<p><img src="output_83_2.png" alt="png"></p>
<p>通过使用坐标变换，数据则不会被修剪，从本质上说，它只是将数据放大或缩小到指定的范围。</p>
<p>最后，使用<code>expand_limits()</code>来单向扩展值域也是可以的。不过，不能用它来缩减值域：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + expand_limits(y=0)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_86_0.png" alt="png"></p>
<h2 id="反转一条连续型坐标轴"><a href="#反转一条连续型坐标轴" class="headerlink" title="反转一条连续型坐标轴"></a>反转一条连续型坐标轴</h2><p>使用 <code>scale_y_reverse</code> 或 <code>scale_x_reverse</code>。坐标轴的方向也可通过指定反序的范围来反转，先写最大值，再写最小值：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_boxplot() + scale_y_reverse()

# 通过指定反序的范围产生类似的效果
ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_boxplot() + scale_y_reverse()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_89_0.png" alt="png"></p>
<p><img src="output_89_1.png" alt="png"></p>
<p>💬<strong>讨论</strong><br>与<code>scale_y_continuous()</code>类似，<code>scale_y_reverse()</code>也无法与ylim配合工作（对x轴属性也一样）。如果你希望反转某条坐标轴并为它设定值域，则必须使用<code>scale_y_continuous()</code>：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_boxplot() + 
 scale_y_reverse(limits=c(8,0))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_91_0.png" alt="png"></p>
<h2 id="修改类别型坐标轴上项目的顺序"><a href="#修改类别型坐标轴上项目的顺序" class="headerlink" title="修改类别型坐标轴上项目的顺序"></a>修改类别型坐标轴上项目的顺序</h2><p>对于类别型（或者说离散型）坐标轴来说，会有一个因子型变量映射到它上面，坐标轴上项目的顺序可以通过设定<code>scale_x_discrete()</code>或<code>scale_y_discrete()</code>中的参数limits来修改。</p>
<p>要手动设定坐标轴上项目的顺序，将一个依理想顺序排列的水平向量指定给limits即可。也可以通过这种方式忽略掉某些项目。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">unique(PlantGrowth$group)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>ctrl</li><li>trt1</li><li>trt2</li></ol>

<details>
    <summary style="display:list-item;cursor:pointer">
        <strong>Levels</strong>:
    </summary>
    <style>
    .list-inline {list-style: none; margin:0; padding: 0}
    .list-inline>li {display: inline-block}
    .list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
    </style>
    <ol class="list-inline"><li>'ctrl'</li><li>'trt1'</li><li>'trt2'</li></ol>
</details>



<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_boxplot()

p + scale_x_discrete(limits=c('ctrl', 'trt1', 'trt2'))

p + scale_x_discrete(limits=c('ctrl', 'trt1'))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre><code>Warning message:
"Removed 10 rows containing missing values (stat_boxplot)."
</code></pre>
<p><img src="output_96_1.png" alt="png"></p>
<p><img src="output_96_2.png" alt="png"></p>
<p>要反转项目顺序，设定 <code>limits=rev(levels(...))</code>，将因子型变量放入括号中即可。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + scale_x_discrete(limits=rev(levels(PlantGrowth$group)))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_98_0.png" alt="png"></p>
<h2 id="设置x轴和y轴的缩放比例"><a href="#设置x轴和y轴的缩放比例" class="headerlink" title="设置x轴和y轴的缩放比例"></a>设置x轴和y轴的缩放比例</h2><p>使用 <code>coord_fixed()</code>。 以下代码将得到 x 轴和 y 轴之间 1：1 的缩放结果。这里的1：1指的是坐标轴单位长度表示的数值范围，而不是总长宽比例。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">sp &lt;- ggplot(marathon, aes(x=Half, y=Full)) + geom_point()

sp + coord_fixed()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_101_0.png" alt="png"></p>
<p>通过在<code>scale_y_continuous()</code>和<code>scale_x_continuous</code>中调整参数breaks，从而将刻度间距设为相同，也会有所帮助</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">sp + coord_fixed() + 
 scale_y_continuous(breaks = seq(0, 420, 30)) + 
 scale_x_continuous(breaks = seq(0, 420, 30))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_103_0.png" alt="png"></p>
<p>如果你希望为两个坐标轴之间指定其他的固定比例而非相同的比例，可以设置参数ratio。对于marathon数据集，我们可能想让对应半程马拉松时间的坐标轴被拉伸到全程马拉松时间坐标轴的两倍。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">sp + coord_fixed(ratio = 1/2) + 
 scale_y_continuous(breaks = seq(0, 420, 30)) + 
 scale_x_continuous(breaks = seq(0, 420, 15))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_105_0.png" alt="png"></p>
<h2 id="设置刻度线的位置"><a href="#设置刻度线的位置" class="headerlink" title="设置刻度线的位置"></a>设置刻度线的位置</h2><p>通常来说ggplot()会自动将刻度线摆放在合适的位置，但如果你希望改变它们的位置，设置标度中的参数breaks即可。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_boxplot()

ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_boxplot() + 
 scale_y_continuous(breaks = c(4, 4.25, 4.5, 5, 6, 8)) + 
 theme_classic()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_108_0.png" alt="png"></p>
<p><img src="output_108_1.png" alt="png"></p>
<p>💬<strong>讨论</strong><br>可以使用<code>seq()</code>函数或运算符：来生成刻度线的位置向量：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">seq(4, 7, by=.5)

5:10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>4</li><li>4.5</li><li>5</li><li>5.5</li><li>6</li><li>6.5</li><li>7</li></ol>




<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li></ol>



<p>设定<code>breaks</code>将会决定为哪些水平加上标签，但不会移除它们或是改变它们的顺序。可以通过指定<code>limits</code>来修改项目的顺序或移除项目.</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_boxplot() + 
 scale_x_discrete(limits=c('trt2','ctrl'), breaks = 'ctrl')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre><code>Warning message:
"Removed 10 rows containing missing values (stat_boxplot)."
</code></pre>
<p><img src="output_112_1.png" alt="png"></p>
<h2 id="移除刻度线和标签"><a href="#移除刻度线和标签" class="headerlink" title="移除刻度线和标签"></a>移除刻度线和标签</h2><p>仅移除刻度标签，使用 <code>theme(axis.text.y = element_blank())</code> (也可对axis.text.x做相同处理)即可。这种方法对于连续型和离散型坐标轴均有效：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_boxplot()

p + theme(axis.text.y = element_blank())<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_115_0.png" alt="png"></p>
<p>要移除刻度线，可使用theme(axis.ticks=element_blank()).这样会同时移除两轴的刻度线（无法仅隐藏单个坐标轴的刻度线）。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + theme(axis.ticks = element_blank(), axis.text.y = element_blank())<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_117_0.png" alt="png"></p>
<p>要移除刻度线、刻度标签和网格线，将<code>breaks</code>设置为<code>NULL</code>即可：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + scale_y_continuous(breaks = NULL)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_119_0.png" alt="png"></p>
<p>💬<strong>讨论</strong><br>事实上，共有三种项目可以控制：刻度标签、刻度线和网格线。对于连续型坐标轴，ggplot()通常会在每个breaks值的位置放置刻度线、刻度标签和主网格线。对于类别型坐标轴，这些元素则出现在每个limits值的位置。<br>我们可以独立控制每条坐标轴上的刻度标签。但是，刻度线和网格线必须同时控制。</p>
<h2 id="修改刻度标签的文本"><a href="#修改刻度标签的文本" class="headerlink" title="修改刻度标签的文本"></a>修改刻度标签的文本</h2><pre class="line-numbers language-R" data-language="R"><code class="language-R">hwp &lt;- ggplot(heightweight, aes(x=ageYear, y=heightIn)) + 
        geom_point()

hwp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_122_0.png" alt="png"></p>
<p>要想任意设定标签，在标度中为breaks和labels赋值即可。其中一个标签含有一个换行符（\n），意为让ggplot()在那里另起一行：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">hwp + scale_y_continuous(breaks = c(50,56,60,66,72),
                        labels = c('Tiny', 'Really\nshort', 'Short',
                                  'Medium', 'Tallish'))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_124_0.png" alt="png"></p>
<p>💬<strong>讨论</strong><br>除了完全任意地设置标签以外，更常见的情况是数据以某种格式存储，而我们希望以另外一种格式显示标签。<br>我们可能向让身高变量显示为英尺和英寸的格式，而不是仅仅显示一个英寸数值。要完成这项任务，我们可以定义一个格式刷（formatter）函数，这样的函数可以读入数值并返回相应的字符串。例如，以下函数可将英寸数值转换为英尺加英寸的格式：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">footinch_formatter &lt;- function(x){
    foot &lt;- floor(x/12)
    inch &lt;- x %% 12
    return(paste(foot, "'", inch, "\"", sep=""))
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>下面是此函数对输入值56~64的返回结果：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">footinch_formatter(56:64)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'4\'8"'</li><li>'4\'9"'</li><li>'4\'10"'</li><li>'4\'11"'</li><li>'5\'0"'</li><li>'5\'1"'</li><li>'5\'2"'</li><li>'5\'3"'</li><li>'5\'4"'</li></ol>



<p>现在就可以使用参数labels把我们的函数传递给标度了：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">hwp + scale_y_continuous(labels = footinch_formatter)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_130_0.png" alt="png"></p>
<p>在图中，每隔五英寸放置了一个自动生成的刻度线，但是对于这个数据来说看起来有点古怪。我们可以通过指定参数breaks让ggplot()每隔四英寸设置一条刻度线取而代之：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">hwp + scale_y_continuous(breaks = seq(48,72,4), labels = footinch_formatter)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_132_0.png" alt="png"></p>
<p>另一项常见任务是将时间测度转换为HH:MM:SS(时：分：秒)或者其他类似的格式。以下函数可以读入分钟的数值并将它们转换为这种格式，同时舍入到最接近的秒数（也可以按照自己的特殊需要来定义）：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">timeHMS_formatter &lt;- function(x){
    h &lt;- floor(x/60)
    m &lt;- floor(x %% 60)
    s &lt;- round(60 * (x %% 1)) # 舍入到最接近的秒数
    lab &lt;- sprintf("%02d:%02d:%02d", h, m, s) # 格式化字符串为HH:MM:SS 的格式
    lab &lt;- gsub("^00:", "", lab) # 如果开头存在00：则移除
    lab &lt;- gsub("^0", "", lab) # 如果开头存在0 则移除
    return(lab)
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">timeHMS_formatter(c(.33, 50, 51.25, 59.32, 60, 60.1, 130.32))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'0:20'</li><li>'50:00'</li><li>'51:15'</li><li>'59:19'</li><li>'1:00:00'</li><li>'1:00:06'</li><li>'2:10:19'</li></ol>



<p>随ggplot2安装的scales包自带了一些内建的格式化函数：  </p>
<ul>
<li>comma() 在千、百万、十亿等位置向数字添加逗号。</li>
<li>dollar()添加一个美元符号并舍入到最接近的美分。</li>
<li>percent()乘以100，舍入到最接近的整数值，并添加一个百分号。</li>
<li>scientific()对大数字和小数字给出科学计数法表示，如 3.30e+05。  </li>
</ul>
<p>如果你希望使用这些函数，必须首先使用library(scales)加载scales包</p>
<h2 id="修改刻度标签的外观"><a href="#修改刻度标签的外观" class="headerlink" title="修改刻度标签的外观"></a>修改刻度标签的外观</h2><p>💡 <strong>方法</strong><br>旋转标签文本</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">bp &lt;- ggplot(PlantGrowth, aes(x=group, y=weight)) + geom_boxplot() + 
       scale_x_discrete(breaks=c('ctrl', 'trt1', 'trt2'),
                       labels=c('Control', 'Treatment 1', 'treatment 2'))

bp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_139_0.png" alt="png"></p>
<p>要将文本逆时针旋转90°，只需使用：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">bp + theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = .5))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_141_0.png" alt="png"></p>
<p>将文本旋转30°可以占用更小的纵向空间，并且易于阅读。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">bp + theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_143_0.png" alt="png"></p>
<p>参数hjust和vjust设置了横向对齐（左对齐/居中/右对齐）和纵向对齐（顶部对齐/居中/底部对齐）。</p>
<p>💬<strong>讨论</strong><br>除了旋转以外，其他的文本属性，如大小、样式（粗体/斜体/常规）和字体族（如 Times 或 Helvetica）可以使用element_text()进行设置：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">bp + theme(axis.text.x = element_text(family='Times', face='italic', color='darkred', size=rel(0.9)))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre><code>Warning message in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
"Windows字体数据库里没有这样的字体系列"
Warning message in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
"Windows字体数据库里没有这样的字体系列"
</code></pre>
<p><img src="output_146_1.png" alt="png"></p>
<p>size 被设为 rel(0.9)，意为当前主题基础字体大小的0.9倍。  </p>
<p>这些命令仅仅控制了单个坐标轴上刻度标签的外观，并不影响其他坐标轴、坐标轴标签、整体的标题或图例。要同时控制所有这些元素的外观，可以使用主题系统。参见 <a href="#"></a></p>
<h2 id="修改坐标轴标签的文本"><a href="#修改坐标轴标签的文本" class="headerlink" title="修改坐标轴标签的文本"></a>修改坐标轴标签的文本</h2><p>使用<code>xlab()</code>或<code>ylab()</code>来修改坐标轴标签的文本：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">hwp &lt;- ggplot(heightweight, aes(x=ageYear, y=heightIn, color=sex)) + 
        geom_point()

# 使用默认的坐标轴标签
hwp

# 设置坐标轴标签
hwp + xlab('Age in years') + ylab('Height in inches')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_150_0.png" alt="png"></p>
<p><img src="output_150_1.png" alt="png"></p>
<p>💬<strong>讨论</strong><br>默认情况下，图形将直接使用数据框中的列名作为数据轴标签。这对于探索数据来说可能还好，但在对外呈现数据时，你也许会希望更具描述力的坐标轴标签。  </p>
<p>除了<code>xlab()</code>和<code>ylab()</code>，也可以使用<code>labs()</code>：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">hwp + labs(x='Age in years', y='Height in inches')<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_152_0.png" alt="png"></p>
<p>设置坐标轴标签的另一种方法是在标度中指定，就像这样：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">hwp + scale_x_continuous(name='Age in years')<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这种方法看起来可能有点别扭，不过可能在你同时设定标度的其他属性（如刻度线位置、值域等）时会比较有用。</p>
<p>当然，这种方法同样适用于其他的坐标轴标度，如scale_y_continuous()、scale_x_discrete()等。</p>
<p>还可以适用\n来添加换行</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">hwp + scale_x_continuous(name = 'Age\n(years)')<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_158_0.png" alt="png"></p>
<h2 id="移除坐标轴标签"><a href="#移除坐标轴标签" class="headerlink" title="移除坐标轴标签"></a>移除坐标轴标签</h2><p>💡 <strong>方法</strong><br>使用theme(axis.title.x = element_black())。对于y轴标签，针对axis.title.y做同样处理。</p>
<p>移除坐标轴标签的另一种方法是将其设为一个空字符串。但如果以这种方式去做，那么图中将仍为文本留出空间。</p>
<h2 id="移除坐标轴标签的外观"><a href="#移除坐标轴标签的外观" class="headerlink" title="移除坐标轴标签的外观"></a>移除坐标轴标签的外观</h2><p>💡 <strong>方法</strong><br>使用<code>axis.title.x()</code>即可</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">hwp &lt;- ggplot(heightweight, aes(x=ageYear, y=heightIn)) + geom_point()

hwp + theme(axis.title.x = element_text(face='italic', color='darkred', size=14))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_164_0.png" alt="png"></p>
<p>💬<strong>讨论</strong><br>对于y轴标签来说，有时不对文本进行旋转会比较有用。<br>当调用<code>element_text()</code>时默认角度为0，所以如果设置了axis.title.y 但没有指定这个角度，它将以文本的顶部指向上方的朝向显示。如果修改了axis.title.y中的其他任何属性并且希望它以正常朝向，即旋转90°显示，则必须手动指定这个角度：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">hwp + ylab('Height\n(inches)') + 
 theme(axis.title.y = element_text(angle = 90, face = 'italic', color = 'darkred', 'size'=14))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_166_0.png" alt="png"></p>
<h2 id="沿坐标轴显示直线"><a href="#沿坐标轴显示直线" class="headerlink" title="沿坐标轴显示直线"></a>沿坐标轴显示直线</h2><p>❓如何沿x轴和y轴显示直线，但不在图形的另外两侧显示？<br>💡使用主题设置中的 <code>axis.line</code> </p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(heightweight, aes(x=ageYear, y=heightIn)) + geom_point()

p + theme_bw() +
  theme(panel.border = element_blank(),
      axis.line = element_line(color='black'))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_169_0.png" alt="png"></p>
<p>如果最初使用的主题在绘图区域的周围就有一条边（如 <code>theme_bw()</code>），则需要同时重置参数 <code>panel.border</code></p>
<p>如果边界线比较粗，则它们的末端将仅会部分地重叠。要让它们完全重叠，设置<code>lineend="square"</code>即可：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 对于较粗地线条，只有一半重叠
p + theme_bw() + 
  theme(panel.border = element_blank(),
      axis.line = element_line(color='black', size=4))

# 完全重叠
p + theme_bw() +
  theme(axis.line = element_line(color='black', size=4, lineend = "square"),
        panel.border = element_blank())<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_171_0.png" alt="png"></p>
<p><img src="output_171_1.png" alt="png"></p>
<h2 id="使用对数坐标轴"><a href="#使用对数坐标轴" class="headerlink" title="使用对数坐标轴"></a>使用对数坐标轴</h2><p>💡使用scale_x_log10() 和/或 scale_y_log10:</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(MASS)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre><code>Warning message:
"package 'MASS' was built under R version 4.0.5"
</code></pre>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(Animals,2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 2</caption>
<thead>
    <tr><th></th><th scope="col">body</th><th scope="col">brain</th></tr>
    <tr><th></th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">Mountain beaver</th><td>  1.35</td><td>  8.1</td></tr>
    <tr><th scope="row">Cow</th><td>465.00</td><td>423.0</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(Animals, aes(x=body, y=brain, label=row.names(Animals))) + 
      geom_text(size=3)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">p

# 使用对数坐标轴
p + scale_x_log10() + 
 scale_y_log10()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_177_0.png" alt="png"></p>
<p><img src="output_177_1.png" alt="png"></p>
<p>关于将刻度线放到何处的问题，ggplot2会试着做出明智的选择，但是如果你不喜欢这些刻度，那么可以通过指定breaks（也可额外指定labels）来修改它们，在这个示例中，自动生成刻度线的间距较理想的间距更远。针对y轴的刻度线，可以像这样<br><strong>10^(0:3)</strong><br>获得一个含有从10<sup>0</sup>到10<sup>3</sup>的10的各次幂的向量</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + scale_x_log10(breaks=10^(-1:5)) + scale_y_log10(breaks=10^(0:3))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_179_0.png" alt="png"></p>
<p>要让刻度标签而使用指数记数法，只要使用scales包中的函数trans_format()即可：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(scales)
p + scale_x_log10(breaks=10^(-1:5),
                 labels=trans_format("log10", math_format(10^.x))) +
  scale_y_log10(breaks=10^(0:3),
               labels=trans_format("log10", math_format(10^.x)))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_181_0.png" alt="png"></p>
<p>使用对数坐标轴的另一种方法是，在将数据映射到x和y坐标之前，先对其进行变换。从技术上讲，坐标轴仍然是线性的——它表示对数据变换后的数值：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(Animals, aes(x=log10(body), y=log10(brain), label=row.names(Animals))) + 
 geom_text(size=3)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_183_0.png" alt="png"></p>
<p>使用这些变换有点复杂—— scales_x_log10() 可以简写，但是对于其他的对数标度而言，需要完整地定义它们：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(scales)

p + scale_x_continuous(trans = log_trans(),
                      breaks = trans_breaks("log", function(x) exp(x)),
                      labels = trans_format("log", math_format(e^.x))) + 
    scale_y_continuous(trans = log2_trans(),
                      breaks = trans_breaks("log2", function(x) 2^x),
                      labels = trans_format("log2", math_format(2^x)))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_185_0.png" alt="png"></p>
<p>也可以只使用一条对数坐标轴。这种做法对于呈现金融数据往往是有用的，因为这样往往能更好地展示出按比例的变化。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">options(repr.plot.width = 8, repr.plot.height = 3 )
ggplot(aapl, aes(x=date, y=adj_price)) + geom_line()

ggplot(aapl, aes(x=date, y=adj_price)) + geom_line() + 
 scale_y_log10(breaks=c(2,10,50,250))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_187_0.png" alt="png"></p>
<p><img src="output_187_1.png" alt="png"></p>
<h2 id="为对数坐标轴添加刻度"><a href="#为对数坐标轴添加刻度" class="headerlink" title="为对数坐标轴添加刻度"></a>为对数坐标轴添加刻度</h2><p>❓如何为对数坐标轴添加间距递减的刻度线<br>💡使用<code>annotation_logticks()</code>  </p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(MASS)
library(scales)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre><code>Warning message:
"package 'MASS' was built under R version 4.0.5"
</code></pre>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(Animals, 2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 2</caption>
<thead>
    <tr><th></th><th scope="col">body</th><th scope="col">brain</th></tr>
    <tr><th></th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">Mountain beaver</th><td>  1.35</td><td>  8.1</td></tr>
    <tr><th scope="row">Cow</th><td>465.00</td><td>423.0</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(Animals, aes(x=body, y=brain, label=rownames(Animals))) + 
 geom_text(size=3) + 
 annotation_logticks() + 
 theme_bw() +
 scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x), 
               labels = trans_format("log10", math_format(10^.x))) + 
 scale_y_log10(breaks = trans_breaks("log10", function(x) 10^x),
               labels = trans_format("log10", math_format(10^.x)))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_192_0.png" alt="png"></p>
<p>💬<strong>讨论</strong><br>使用annotation_logticks()创建的刻度线事实上是绘图区域中的几何对象。在每个10的幂次处有一条长刻度线，在每个5的位置处有一条中等长度的刻度线。</p>
<h2 id="绘制环状图形"><a href="#绘制环状图形" class="headerlink" title="绘制环状图形"></a>绘制环状图形</h2><p>💡<strong>方法</strong><br>使用<code>coord_polar()</code>。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(wind,5)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 5 × 7</caption>
<thead>
    <tr><th></th><th scope="col">TimeUTC</th><th scope="col">Temp</th><th scope="col">WindAvg</th><th scope="col">WindMax</th><th scope="col">WindDir</th><th scope="col">SpeedCat</th><th scope="col">DirCat</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">3</th><td> 0</td><td>3.54</td><td>9.52</td><td>10.39</td><td>89</td><td>10-15</td><td>90</td></tr>
    <tr><th scope="row">4</th><td> 5</td><td>3.52</td><td>9.10</td><td> 9.90</td><td>92</td><td>5-10 </td><td>90</td></tr>
    <tr><th scope="row">5</th><td>10</td><td>3.53</td><td>8.73</td><td> 9.51</td><td>92</td><td>5-10 </td><td>90</td></tr>
    <tr><th scope="row">6</th><td>15</td><td>3.63</td><td>8.97</td><td> 9.90</td><td>94</td><td>5-10 </td><td>90</td></tr>
    <tr><th scope="row">7</th><td>20</td><td>3.71</td><td>8.51</td><td> 9.41</td><td>97</td><td>5-10 </td><td>90</td></tr>
</tbody>
</table>



<p>我们将使用<code>geom_histogram()</code>对每个<code>SpeedCat</code>和<code>DirCat</code>的类别绘制样本数量的计数值。将binwidth设置为15以使直方图的origin开始于-7.5的位置，这样每个扇形就会居中于0、15、30等位置：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(wind, aes(x=DirCat, fill=SpeedCat)) + 
 geom_histogram(binwidth=15, boundary=-7.5) + 
 coord_polar() + 
 scale_x_continuous(limits=c(0,360))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre><code>Warning message:
"Removed 8 rows containing missing values (geom_bar)."
</code></pre>
<p><img src="output_198_1.png" alt="png"></p>
<p>使用坐标图时要小心，因为这种图形会扭曲对数据的感知。本例中，在210°位置有15个风速为15-20的观测以及13个风速大于20的观测，但是对图形匆匆一瞥时，看起来风速大于20的观测更多一些，而且还存在三个风速10-15的观测，它们却几乎不可见。</p>
<p>在这个例子中，我们可以通过反转图例、使用不同的调色板、添加外框线以及将分割点设置为某些更熟悉的值的方式，让图形稍微美观一些：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(wind, aes(x=DirCat, fill=SpeedCat)) + 
 theme_bw() + 
 geom_histogram(binwidth=15, origin=-7.5, color='black', size=.25) + 
 guides(fill=guide_legend(reverse = TRUE)) + 
 coord_polar() + 
 scale_x_continuous(limits = c(0,360), breaks = seq(0,360,by=45),
                   minor_breaks=seq(0, 360, by=15)) + 
 scale_fill_brewer()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre><code>Warning message:
"`origin` is deprecated. Please use `boundary` instead."
Warning message:
"Removed 8 rows containing missing values (geom_bar)."
</code></pre>
<p><img src="output_201_1.png" alt="png"></p>
<p>使用参数start设置图形起始的角度可能也是有用的，特别是当我们使用一个离散型变量映射为角度（theta）时。起始角度的值以弧度计，如果知道要调整的角度，则必须将它转换为弧度：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">coord_polar(start = -45 * pi / 180)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre><code>&lt;ggproto object: Class CoordPolar, Coord, gg&gt;
    aspect: function
    backtransform_range: function
    clip: on
    default: FALSE
    direction: 1
    distance: function
    is_free: function
    is_linear: function
    labels: function
    modify_scales: function
    r: y
    range: function
    render_axis_h: function
    render_axis_v: function
    render_bg: function
    render_fg: function
    setup_data: function
    setup_layout: function
    setup_panel_guides: function
    setup_panel_params: function
    setup_params: function
    start: -0.785398163397448
    theta: x
    train_panel_guides: function
    transform: function
    super:  &lt;ggproto object: Class CoordPolar, Coord, gg&gt;
</code></pre>
<p>极坐标可与其他几何对象搭配使用，包括线和点。在使用这些几何对象时有一些重要的问题要牢记于心。首先，默认情况下，对于映射到y（或者说r）的变量，最小值将被映射到中心；</p>
<h2 id="在坐标轴上使用日期"><a href="#在坐标轴上使用日期" class="headerlink" title="在坐标轴上使用日期"></a>在坐标轴上使用日期</h2><h2 id="有用的链接"><a href="#有用的链接" class="headerlink" title="有用的链接"></a>有用的链接</h2><p>比较好的干货博客<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/03255dd4324d">r&lt;-ggplot2 修改x和y轴刻度</a></p>
<h1 id="第九章-控制图形的整体外观"><a href="#第九章-控制图形的整体外观" class="headerlink" title="第九章 控制图形的整体外观"></a>第九章 控制图形的整体外观</h1><h2 id="设置图形标题"><a href="#设置图形标题" class="headerlink" title="设置图形标题"></a>设置图形标题</h2><h1 id="第十章-图例"><a href="#第十章-图例" class="headerlink" title="第十章 图例"></a>第十章 图例</h1><h2 id="移除图例"><a href="#移除图例" class="headerlink" title="移除图例"></a>移除图例</h2><p>💡使用 guides()，并指定需要移除图例的标度</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(PlantGrowth, aes(x=group, y=weight, fill=group)) + 
 geom_boxplot() + 
 theme_bw(base_size = 25) + 
 theme(panel.grid = element_blank())<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + guides(fill="none")<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_214_0.png" alt="png"></p>
<p>或者在标度中设置 guide=”none”</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + scale_fill_discrete(guide="none")<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_216_0.png" alt="png"></p>
<p>使用主题系统 theme，会移除所有图例</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + theme(legend.position = "none")<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_218_0.png" alt="png"></p>
<p>当某个变量被映射到图形属性fill上时，默认使用的标度为scale_fill_discrete() (与scale_fill_hue()等价)，这会将不同因子水平映射到色环上均匀分布的颜色值上。对于fill来说，也有其他的标度可用，如scale_fill_manual()。</p>
<h2 id="修改图例的位置"><a href="#修改图例的位置" class="headerlink" title="修改图例的位置"></a>修改图例的位置</h2><p>💡使用theme(legend.position=…)即可。通过指定位置参数为top、left、right或bottom，图例即可被放置在顶部、左侧、右侧或底部：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + 
 scale_fill_brewer(palette = 'Pastel2') + 
 theme(legend.position = 'top')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_222_0.png" alt="png"></p>
<p>通过指定像 legend.position=c(1,0) 这样的位置坐标，图例亦可被置于绘图区域内部。空间中左下角为原点(0,0)，右上角为(1,1)</p>
<p>也可以使用 legend.justification 来指定图例框的哪一部分被放置到 legend.position 所指定的位置上。默认情况下，图例的中心(0.5, 0.5)被置于给定的坐标处，但是指定一个不同的点往往是有用的。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + theme(legend.position = c(0.95,0.025), legend.justification = c(1,0))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_225_0.png" alt="png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + theme(legend.position = c(1,1), legend.justification = c(1,1))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_226_0.png" alt="png"></p>
<p>在绘图区域内放置图例时，添加一个不透明的边界使其与图形分开可能会有所帮助</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + theme(legend.background = element_rect(fill = "white",color = "black"),
          legend.position = c(.85, .2))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_228_0.png" alt="png"></p>
<h2 id="修改图例项目的顺序"><a href="#修改图例项目的顺序" class="headerlink" title="修改图例项目的顺序"></a>修改图例项目的顺序</h2><p>将对应标度的参数limits设置为理想的顺序即可</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + scale_fill_discrete(limits=c('trt1','trt2','ctrl'))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_231_0.png" alt="png"></p>
<p>要注意的是，x轴上的顺序并没有改变。要修改这个顺序，需要设置 scale_x_discrete() 的limits参数，或者修改数据，使其拥有一个不同因子的水平顺序。</p>
<p>使用灰度调色板</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + scale_fill_grey(start = .5, end = .1, limits=c('trt1', 'trt2', 'ctrl'))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_234_0.png" alt="png"></p>
<h2 id="反转图例项目的顺序"><a href="#反转图例项目的顺序" class="headerlink" title="反转图例项目的顺序"></a>反转图例项目的顺序</h2><p>💡添加guides(fill=guide_legend(reverse=TRUE))以反转图例的顺序（对于其他图形属性，使用相应图形属性的名称，如color或size替换fill即可）：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(PlantGrowth, aes(x=group, y=weight, fill=group)) +
 theme_bw(base_size = 25) + 
 geom_boxplot()
p<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_237_0.png" alt="png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + guides(fill=guide_legend(reverse = TRUE))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_238_0.png" alt="png"></p>
<p>在设定标度的同时也可以控制图例</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">scale_fill_hue(guide=guide_legend(reverse = TRUE))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="修改图例标题"><a href="#修改图例标题" class="headerlink" title="修改图例标题"></a>修改图例标题</h2><pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(PlantGrowth, aes(x=group, y=weight, fill=group)) + 
 geom_boxplot() + 
 theme_bw(base_size = 25)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">p<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_243_0.png" alt="png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 指定图形属性进行命名
p + labs(fill='condition')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_244_0.png" alt="png"></p>
<p>在设定标度时也可以设置图例标题。由于图例和坐标轴均为引导元素，这样做与设置x轴或y轴标题的原理是相同的。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + scale_fill_discrete(name='condition')<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如果有多个变量被映射到带有图例的图形属性（即除x和y以外的图形属性），可以分别设置每个图例的标题。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(gcookbook)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">hw &lt;- ggplot(data = heightweight, aes(x=ageYear, y=heightIn, color=sex)) + 
 geom_point(aes(size=weightLb)) + scale_size_continuous(range = c(1,4)) + 
 theme_bw(base_size = 25) + 
 theme(panel.grid = element_blank())

hw

hw + labs(color='Male/Female', size='weight\n(pounds)')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_249_0.png" alt="png"></p>
<p><img src="output_249_1.png" alt="png"></p>
<h2 id="修改图例标题的外观"><a href="#修改图例标题的外观" class="headerlink" title="修改图例标题的外观"></a>修改图例标题的外观</h2><p>使用theme(legend.title=element_text())</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(PlantGrowth, aes(x=group, y=weight, fill=group)) + 
 geom_boxplot() + theme_bw(base_size = 25)

p + theme(legend.title = element_text(face = 'italic', family = 'times', color = 'red', size = 14))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre><code>Warning message in grid.Call(C_stringMetric, as.graphicsAnnot(x$label)):
"Windows字体数据库里没有这样的字体系列"
Warning message in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
"Windows字体数据库里没有这样的字体系列"
Warning message in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
"Windows字体数据库里没有这样的字体系列"
</code></pre>
<p><img src="output_252_1.png" alt="png"></p>
<h2 id="移除图例标题"><a href="#移除图例标题" class="headerlink" title="移除图例标题"></a>移除图例标题</h2><p>添加语句guides(fill=guide_legend(title=NULL))可以从图例中移除标题</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(PlantGrowth, aes(x=group, y=weight, fill=group)) + 
 geom_boxplot() + 
 guides(fill=guide_legend(title = NULL))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_255_0.png" alt="png"></p>
<h2 id="修改图例标签"><a href="#修改图例标签" class="headerlink" title="修改图例标签"></a>修改图例标签</h2><pre class="line-numbers language-R" data-language="R"><code class="language-R">library(gcookbook)

p &lt;- ggplot(PlantGrowth, aes(x=group, y=weight, fill=group)) + 
 geom_boxplot()

p + scale_fill_discrete(labels=c('control','Treatmant1','Treatmant2'))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_257_0.png" alt="png"></p>
<p>如果有一个变量被分别映射到两个图形属性，则默认会生成一个组合了两种情况的图例。如果希望修改图例标签，则必须同时修改两种标度中的标签；否则会得到两个分离的图例。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(heightweight, aes(x=ageYear, y=heightIn, shape=sex, color=sex))+ 
 geom_point() + 
 theme_bw(base_size = 25)

p 

# 修改一个标度中的标签
p + scale_shape_discrete(labels=c('Female','Male'))

p + scale_shape_discrete(labels=c('Female','Male')) + 
 scale_color_discrete(labels=c('Female','Male'))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_259_0.png" alt="png"></p>
<p><img src="output_259_1.png" alt="png"></p>
<p><img src="output_259_2.png" alt="png"></p>
<h2 id="修改图例标签的外观"><a href="#修改图例标签的外观" class="headerlink" title="修改图例标签的外观"></a>修改图例标签的外观</h2><p>使用theme(legend.text=element_text())</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + theme(legend.text = element_text(face = 'italic', family = 'Times', color = 'red', size = 14))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre><code>Warning message in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
"Windows字体数据库里没有这样的字体系列"
Warning message in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, :
"Windows字体数据库里没有这样的字体系列"
</code></pre>
<p><img src="output_262_1.png" alt="png"></p>
<h2 id="更改图例条目布局"><a href="#更改图例条目布局" class="headerlink" title="更改图例条目布局"></a>更改图例条目布局</h2><p>参考链接<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_46084093/article/details/103921549">R ggplot2 改图例条目布局</a></p>
<p>快捷调整方法在theme主题系统，精确调整在 <code>guides</code>指南系统</p>
<p>精准调整，参数有</p>
<ul>
<li>ncol表示列数，</li>
<li>nrow表示行数，ncol和nrow设置一个即可</li>
<li>byrow 可选T/F，默认F，即按照列填充</li>
<li>reverse 可选T/F，默认F，即升序填充，反之则降序</li>
</ul>
<pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment"># 快捷调整</span>
base <span class="token operator">+</span> theme<span class="token punctuation">(</span>
  legend.direction <span class="token operator">=</span> <span class="token string">"horizontal"</span>
<span class="token punctuation">)</span> 

<span class="token comment"># 精准调整</span>
base <span class="token operator">+</span> guides<span class="token punctuation">(</span>
  color <span class="token operator">=</span> guide_legend<span class="token punctuation">(</span>
    ncol <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> 
    byrow <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span>
    reverse <span class="token operator">=</span> T<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h1 id="第十一章-分面"><a href="#第十一章-分面" class="headerlink" title="第十一章 分面"></a>第十一章 分面</h1><h2 id="使用分面将数据分割绘制到子图中"><a href="#使用分面将数据分割绘制到子图中" class="headerlink" title="使用分面将数据分割绘制到子图中"></a>使用分面将数据分割绘制到子图中</h2><pre class="line-numbers language-R" data-language="R"><code class="language-R">head(mpg,2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A tibble: 2 × 11</caption>
<thead>
    <tr><th scope="col">manufacturer</th><th scope="col">model</th><th scope="col">displ</th><th scope="col">year</th><th scope="col">cyl</th><th scope="col">trans</th><th scope="col">drv</th><th scope="col">cty</th><th scope="col">hwy</th><th scope="col">fl</th><th scope="col">class</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th></tr>
</thead>
<tbody>
    <tr><td>audi</td><td>a4</td><td>1.8</td><td>1999</td><td>4</td><td>auto(l5)  </td><td>f</td><td>18</td><td>29</td><td>p</td><td>compact</td></tr>
    <tr><td>audi</td><td>a4</td><td>1.8</td><td>1999</td><td>4</td><td>manual(m5)</td><td>f</td><td>21</td><td>29</td><td>p</td><td>compact</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(mpg, aes(x=displ, y=hwy)) + geom_point()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 纵向排列的子面板根据 drv 分面
p + facet_grid(drv ~ .)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>也可以使用 <code>facet_wrap( ~ drv)</code></p>
<p><img src="output_267_0.png" alt="png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 横向排列的子面板根据 cyl 分面
p + facet_grid(. ~ cyl)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_268_0.png" alt="png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 同时纵向(drv)和横向(cyl)分割
p + facet_grid(drv ~ cyl)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_269_0.png" alt="png"></p>
<h2 id="在不同坐标轴下使用分面"><a href="#在不同坐标轴下使用分面" class="headerlink" title="在不同坐标轴下使用分面"></a>在不同坐标轴下使用分面</h2><p>将标度设置为 “free_x”、”free_y”、或”free”</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 使用自由的 y 标度
p + facet_grid(drv ~ cyl, scales = 'free_y')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_272_0.png" alt="png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + facet_grid(drv ~ cyl, scales = 'free')<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_273_0.png" alt="png"></p>
<h2 id="修改分面的文本标签"><a href="#修改分面的文本标签" class="headerlink" title="修改分面的文本标签"></a>修改分面的文本标签</h2><p>💡修改因子各水平的名称即可</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">mpg2 &lt;- mpg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">levels(mpg2$drv)[levels(mpg2$drv)=="4"] &lt;- "4wd"
levels(mpg2$drv)[levels(mpg2$drv)=="f"] &lt;- "Font"
levels(mpg2$drv)[levels(mpg2$drv)=="r"] &lt;- "Rear"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">levels(mpg$drv)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre><code>NULL
</code></pre>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(mpg2, aes(x=displ, y=hwy)) + geom_point() + facet_grid(drv ~ .)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_279_0.png" alt="png"></p>
<h2 id="修改分面标签和表标题的外观"><a href="#修改分面标签和表标题的外观" class="headerlink" title="修改分面标签和表标题的外观"></a>修改分面标签和表标题的外观</h2><p>使用主题系统，通过设置 <code>strip.text()</code> 来控制文本的外观，设置strip.background() 以控制背景的外观：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(gcookbook)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(cabbage_exp,2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 6</caption>
<thead>
    <tr><th></th><th scope="col">Cultivar</th><th scope="col">Date</th><th scope="col">Weight</th><th scope="col">sd</th><th scope="col">n</th><th scope="col">se</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>c39</td><td>d16</td><td>3.18</td><td>0.9566144</td><td>10</td><td>0.30250803</td></tr>
    <tr><th scope="row">2</th><td>c39</td><td>d20</td><td>2.80</td><td>0.2788867</td><td>10</td><td>0.08819171</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(cabbage_exp, aes(x=Cultivar, y=Weight)) + geom_bar(stat = 'identity') + 
 facet_grid(. ~ Date) + 
 theme_bw(base_size = 20) + 
 theme(strip.background = element_rect(fill = 'lightblue', color='black', size=1),
       strip.text = element_text(face='bold', size=rel(1.5))
      )<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_284_0.png" alt="png"></p>
<h2 id="facet-wrap-与-facet-grid"><a href="#facet-wrap-与-facet-grid" class="headerlink" title="facet_wrap 与 facet_grid"></a>facet_wrap 与 facet_grid</h2><p>两个函数这两个函数都可以进行分面，但使用和达到的效果有所不同。<br>参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/u014566586/article/details/100190957">ggplot2 分面相关设置（facet）</a></p>
<pre class="line-numbers language-r" data-language="r"><code class="language-r">facet_wrap<span class="token punctuation">(</span>facets<span class="token punctuation">,</span> nrow <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> ncol <span class="token operator">=</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> scales <span class="token operator">=</span> <span class="token string">"fixed"</span><span class="token punctuation">,</span> shrink <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> as.table <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> drop <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>

facet_grid<span class="token punctuation">(</span>facets<span class="token punctuation">,</span> margins <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> scales <span class="token operator">=</span> <span class="token string">"fixed"</span><span class="token punctuation">,</span> space <span class="token operator">=</span> <span class="token string">"fixed"</span><span class="token punctuation">,</span> shrink <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> labeller <span class="token operator">=</span> <span class="token string">"label_value"</span><span class="token punctuation">,</span> as.table <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> drop <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>其中facet_wrap和facet_grid不同在于facet_wrap是基于一个因子进行设置，facets表示形式为：<del>变量（</del>单元格） </p>
<p>而facet_grid是基于两个因子进行设置，facets表示形式为：变量<del>变量（行</del>列），如果把一个因子用点表示，也可以达到facet_wrap的效果，也可以用加号设置成两个以上变量</p>
<p>例如：变量+变量~变量 的形式，表示对三个变量设置分面。</p>
<p>具体参数：<br>具体的参数（把两个函数参数和在一起）：</p>
<ul>
<li><p>nrow,ncol 分面设置成的行和列，参数为数值，表示几行或者几列</p>
</li>
<li><p>scales  参数fixed表示固定坐标轴刻度，free表示反馈坐标轴刻度，也可以单独设置成free_x或free_y</p>
</li>
<li><p>shrink  也和坐标轴刻度有关，如果为TRUE（默认值）则按统计后的数据调整刻度范围，否则按统计前的数据设定坐标。</p>
</li>
<li><p>drop 表示是否去掉没有数据的分组，默认情况下不显示，逻辑值为FALSE</p>
</li>
<li><p>as.table 和小图排列顺序有关的选项。如果为TRUE（默认）则按表格方式排列，即最大值（指分组level值）排在表格最后即右下角，否则排在左上角。</p>
</li>
<li><p>margins 通过TRUE或者FALSE表示否设置而一个总和的分面变量，默认情况为FALSE，即不设置</p>
</li>
<li><p>space    表示分面空间是否可以按照数据进行缩放，参数和scales一样</p>
</li>
</ul>
<h1 id="第十二章-配色"><a href="#第十二章-配色" class="headerlink" title="第十二章 配色"></a>第十二章 配色</h1><p>对于点形来说，大多数点形，整个点的颜色是由 color 控制的，而不是 fill。例外的情况是21-25号点，它们不仅有填充色，也有边界色</p>
<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQyGbFLS6kIzEFecRarshBazlmY_FGGN4pX1w&amp;usqp=CAU" width="700">

<p>函数<code>scale_fill_hue()</code>中，颜色来自 HCL 色系（hue-chroma-lightness：色相-色度-亮度）的色轮，默认亮度是54（取值为0~100）</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(gcookbook)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(data = uspopage, aes(x = Year, y = Thousands, fill = AgeGroup)) + 
 geom_area()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">h &lt;- ggplot(heightweight, aes(x=ageYear, y=heightIn, color=sex)) + 
 geom_point()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 默认亮度 65
h

# 略微加深
h + scale_color_hue(l=45)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_292_0.png" alt="png"></p>
<p><img src="output_292_1.png" alt="png"></p>
<p>ColorBrewer包提供了很多调色板，你可以生成一张图来查看该包中的所有调色板：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(RColorBrewer)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">display.brewer.all()<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_295_0.png" alt="png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + scale_fill_brewer(palette = 'Oranges')<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_296_0.png" alt="png"></p>
<p>你还可以使用灰度调色板，它很适合黑白打印。标度范围是0~1（其中0对应黑色，1对应白色），灰度调色板的默认范围是0.2~0.8，但这个可以改。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + scale_fill_grey(start = 0, end = 0.7)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_298_0.png" alt="png"></p>
<h2 id="对离散型变量使用自定义调色板"><a href="#对离散型变量使用自定义调色板" class="headerlink" title="对离散型变量使用自定义调色板"></a>对离散型变量使用自定义调色板</h2><pre class="line-numbers language-R" data-language="R"><code class="language-R"># 使用颜色名
h + scale_color_manual(values = c('red','blue'))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_300_0.png" alt="png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 使用RGB值
h + theme_bw(base_size = 25) +
 scale_color_manual(values = c('#CC6666','#7777DD'))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_301_0.png" alt="png"></p>
<p>💬参数 values 向量中的元素顺序自动匹配离散标度对应因子水平的顺序。<br>查看因子顺序的方法：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">levels(heightweight$sex)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'f'</li><li>'m'</li></ol>



<p>如果变量是字符型向量而非因子形式，那么它会被自动转化为因子；顺序也默认地按照字母表排序.</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 自定义颜色分配的顺序
h + scale_color_manual(values = c(m='blue',f='red'))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_305_0.png" alt="png"></p>
<p>RGB 颜色由6个数字组成:0-9,A-F(10-15).形如: <code>#RRGGBB</code><br>每一个颜色由两个数字来表示,范围从 00 到 FF( 对应十进制中的255 )<br>💡十六进制中每个颜色通道常常重复同样的数字,因为这样更容易阅读并且第二个数字的精确值对外观的影响并不是很明显.</p>
<p>这里总结了一些设置RGB颜色的经验:  </p>
<ul>
<li>在一般情况下,更大的数字更明亮,较小的数字更暗淡.</li>
<li>如果想得到灰色,将三个颜色通道设置为相同的值.</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://html-color-codes.com/">RGB颜色十六进制表</a></p>
<h2 id="对连续型变量使用自定义调色板"><a href="#对连续型变量使用自定义调色板" class="headerlink" title="对连续型变量使用自定义调色板"></a>对连续型变量使用自定义调色板</h2><p>对连续型变量自定义渐变式的调色板.颜色可以用已命名的,也可以用RGB值来指定.</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(gcookbook)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 基础图形
p &lt;- ggplot(heightweight, aes(x=ageYear, y=heightIn, color=weightLb)) + 
 geom_point(size=3)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 默认颜色
p <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_313_0.png" alt="png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 使用两种颜色的渐变色
p + scale_color_gradient(low = 'black', high = 'white')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_314_0.png" alt="png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 渐变色中间用白色划分
library(scales)
# muted, 来自 scales 包: 使标准颜色变得更柔和, 饱和度更低
p + scale_color_gradient2(low = muted('blue'), mid = 'white', high = muted('red'), midpoint = 110)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_315_0.png" alt="png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># n个颜色的渐变
p + scale_color_gradientn(colors = c('darkred','orange','yellow','white'))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<p><img src="output_316_0.png" alt="png"></p>
<img width="700" src="data:image/png;base64,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" title="连续的填充色和轮廓色标度">

<h2 id="根据数值设定阴影颜色"><a href="#根据数值设定阴影颜色" class="headerlink" title="根据数值设定阴影颜色"></a>根据数值设定阴影颜色</h2><p>💡增加一列来对y进行划分,然后将该列映射到填充色标度上. 在本例中,首先对数据进行正负划分.</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(gcookbook)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">cb&lt;- subset(climate, Source=='Berkeley')<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">cb$valence[ cb$Anomaly10y &gt;= 0 ] &lt;- 'pos'
cb$valence[ cb$Anomaly10y &lt; 0 ] &lt;- 'neg'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(cb,2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 7</caption>
<thead>
    <tr><th></th><th scope="col">Source</th><th scope="col">Year</th><th scope="col">Anomaly1y</th><th scope="col">Anomaly5y</th><th scope="col">Anomaly10y</th><th scope="col">Unc10y</th><th scope="col">valence</th></tr>
    <tr><th></th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;chr&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>Berkeley</td><td>1800</td><td>NA</td><td>NA</td><td>-0.435</td><td>0.505</td><td>neg</td></tr>
    <tr><th scope="row">2</th><td>Berkeley</td><td>1801</td><td>NA</td><td>NA</td><td>-0.453</td><td>0.493</td><td>neg</td></tr>
</tbody>
</table>



<p>对数据划分正负之后，就可以将valence变量映射到填充色上来作图了</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">options(repr.plot.width=12)
ggplot(cb, aes(x=Year, y=Anomaly10y)) + 
 geom_area(aes(fill=valence)) + 
 geom_line(size=1.5) + 
 geom_hline(yintercept = 0) + 
 theme_bw(base_size = 20) + 
 theme(panel.grid = element_blank(),
       legend.position = 'top') + 
 scale_fill_manual(values = c('neg'='blue','pos'='red'))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_325_0.png" alt="png"></p>
<p>如果你仔细观察此图，会发现在0水平线附近有一些凌乱的阴影。这是因为两个颜色区域都是各自的数据点多边形包围形成的，而这些数据点并不都在0上。<br>为了解决这个问题，可以用approx()将数据插值到1000个点左右。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># approx() 返回一个列表，包含 x 和 y向量
interp &lt;- approx(cb$Year, cb$Anomaly10y, n = 1000)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 放在数据框中，并重新计算valence
cbi &lt;- data.frame(Year=interp$x, Anomaly10y=interp$y) 
cbi$valence[ cbi$Anomaly10y &gt;=0 ] &lt;- 'pos'
cbi$valence[ cbi$Anomaly10y &lt;0 ] &lt;- 'neg'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">options(repr.plot.width=12)
ggplot(cbi, aes(x=Year, y=Anomaly10y)) + 
 geom_area(aes(fill=valence), alpha=0.6) + 
 geom_line(size=1.5) + 
 geom_hline(yintercept = 0,size=1.2) + 
 theme_bw(base_size = 20) + 
 theme(panel.grid = element_blank(),
       legend.position = 'top') + 
 scale_fill_manual(values = c('neg'='#CCEEFF','pos'='#FFDDDD'))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_329_0.png" alt="png"></p>
<h1 id="第十三章-其他图形"><a href="#第十三章-其他图形" class="headerlink" title="第十三章 其他图形"></a>第十三章 其他图形</h1><h2 id="绘制相关矩阵图"><a href="#绘制相关矩阵图" class="headerlink" title="绘制相关矩阵图"></a>绘制相关矩阵图</h2><pre class="line-numbers language-R" data-language="R"><code class="language-R">head(mtcars,3)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 3 × 11</caption>
<thead>
    <tr><th></th><th scope="col">mpg</th><th scope="col">cyl</th><th scope="col">disp</th><th scope="col">hp</th><th scope="col">drat</th><th scope="col">wt</th><th scope="col">qsec</th><th scope="col">vs</th><th scope="col">am</th><th scope="col">gear</th><th scope="col">carb</th></tr>
    <tr><th></th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">Mazda RX4</th><td>21.0</td><td>6</td><td>160</td><td>110</td><td>3.90</td><td>2.620</td><td>16.46</td><td>0</td><td>1</td><td>4</td><td>4</td></tr>
    <tr><th scope="row">Mazda RX4 Wag</th><td>21.0</td><td>6</td><td>160</td><td>110</td><td>3.90</td><td>2.875</td><td>17.02</td><td>0</td><td>1</td><td>4</td><td>4</td></tr>
    <tr><th scope="row">Datsun 710</th><td>22.8</td><td>4</td><td>108</td><td> 93</td><td>3.85</td><td>2.320</td><td>18.61</td><td>1</td><td>1</td><td>4</td><td>1</td></tr>
</tbody>
</table>



<p>首先，使用cor函数计算相关矩阵，将会得到每两列之间的相关系数：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">mcor &lt;- cor(mtcars)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 输出 mcor，保留两位小数
round(mcor, digits = 2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A matrix: 11 × 11 of type dbl</caption>
<thead>
    <tr><th></th><th scope="col">mpg</th><th scope="col">cyl</th><th scope="col">disp</th><th scope="col">hp</th><th scope="col">drat</th><th scope="col">wt</th><th scope="col">qsec</th><th scope="col">vs</th><th scope="col">am</th><th scope="col">gear</th><th scope="col">carb</th></tr>
</thead>
<tbody>
    <tr><th scope="row">mpg</th><td> 1.00</td><td>-0.85</td><td>-0.85</td><td>-0.78</td><td> 0.68</td><td>-0.87</td><td> 0.42</td><td> 0.66</td><td> 0.60</td><td> 0.48</td><td>-0.55</td></tr>
    <tr><th scope="row">cyl</th><td>-0.85</td><td> 1.00</td><td> 0.90</td><td> 0.83</td><td>-0.70</td><td> 0.78</td><td>-0.59</td><td>-0.81</td><td>-0.52</td><td>-0.49</td><td> 0.53</td></tr>
    <tr><th scope="row">disp</th><td>-0.85</td><td> 0.90</td><td> 1.00</td><td> 0.79</td><td>-0.71</td><td> 0.89</td><td>-0.43</td><td>-0.71</td><td>-0.59</td><td>-0.56</td><td> 0.39</td></tr>
    <tr><th scope="row">hp</th><td>-0.78</td><td> 0.83</td><td> 0.79</td><td> 1.00</td><td>-0.45</td><td> 0.66</td><td>-0.71</td><td>-0.72</td><td>-0.24</td><td>-0.13</td><td> 0.75</td></tr>
    <tr><th scope="row">drat</th><td> 0.68</td><td>-0.70</td><td>-0.71</td><td>-0.45</td><td> 1.00</td><td>-0.71</td><td> 0.09</td><td> 0.44</td><td> 0.71</td><td> 0.70</td><td>-0.09</td></tr>
    <tr><th scope="row">wt</th><td>-0.87</td><td> 0.78</td><td> 0.89</td><td> 0.66</td><td>-0.71</td><td> 1.00</td><td>-0.17</td><td>-0.55</td><td>-0.69</td><td>-0.58</td><td> 0.43</td></tr>
    <tr><th scope="row">qsec</th><td> 0.42</td><td>-0.59</td><td>-0.43</td><td>-0.71</td><td> 0.09</td><td>-0.17</td><td> 1.00</td><td> 0.74</td><td>-0.23</td><td>-0.21</td><td>-0.66</td></tr>
    <tr><th scope="row">vs</th><td> 0.66</td><td>-0.81</td><td>-0.71</td><td>-0.72</td><td> 0.44</td><td>-0.55</td><td> 0.74</td><td> 1.00</td><td> 0.17</td><td> 0.21</td><td>-0.57</td></tr>
    <tr><th scope="row">am</th><td> 0.60</td><td>-0.52</td><td>-0.59</td><td>-0.24</td><td> 0.71</td><td>-0.69</td><td>-0.23</td><td> 0.17</td><td> 1.00</td><td> 0.79</td><td> 0.06</td></tr>
    <tr><th scope="row">gear</th><td> 0.48</td><td>-0.49</td><td>-0.56</td><td>-0.13</td><td> 0.70</td><td>-0.58</td><td>-0.21</td><td> 0.21</td><td> 0.79</td><td> 1.00</td><td> 0.27</td></tr>
    <tr><th scope="row">carb</th><td>-0.55</td><td> 0.53</td><td> 0.39</td><td> 0.75</td><td>-0.09</td><td> 0.43</td><td>-0.66</td><td>-0.57</td><td> 0.06</td><td> 0.27</td><td> 1.00</td></tr>
</tbody>
</table>



<p>如果数据含有不能用来计算系数的任何列（比如一列姓名），应该先将这些列剔除。如果在原始数据中存在缺失值（NA），得到的相关矩阵也会有缺失值。为了克服这个问题，可以使用函数选项use=”complete.obs”或者use=”pairwise.complete.obs”。</p>
<p>使用corrplot包来绘制相关矩阵图。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(corrplot)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre><code>Warning message:
"package 'corrplot' was built under R version 4.0.5"
corrplot 0.89 loaded
</code></pre>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">corrplot(mcor)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_339_0.png" alt="png"></p>
<p>💬<strong>讨论</strong><br><code>corrplot()</code>函数有相当多的选项。这里给出一个绘制相关矩阵图的例子，例图使用颜色方块和黑色文本标签，并且上边的文本标签呈45°右倾。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">corrplot(mcor, method = "shade", shade.col = NA, tl.col = "black", tl.srt = 45)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_341_0.png" alt="png"></p>
<p>将相关系数展示在矩阵的每一个小方块上，同时调淡一点调色板，会使系数更加可读；同时，移除多余的颜色图例。此外，对矩阵重新排序，使得相近的变量在图中更近。其中使用的参数是order=”AOE”（前两个特征向量的角排序）。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">col &lt;- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))

corrplot(mcor, method = "shade", shade.col = NA, tl.col = "black", tl.srt = 45,
        col=col(200), addCoef.col="black", cl.pos = "no", order="AOE")<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<pre><code>Error in colorlegend(colbar = colbar, labels = round(labels, 2), offset = cl.offset, : 找不到对象'vertical'
Traceback:


1. corrplot(mcor, method = "shade", shade.col = NA, tl.col = "black", 
 .     tl.srt = 45, col = col(200), addCoef.col = "black", cl.pos = "no", 
 .     order = "AOE")

2. colorlegend(colbar = colbar, labels = round(labels, 2), offset = cl.offset, 
 .     ratio.colbar = 0.3, cex = cl.cex, xlim = xlim, ylim = ylim, 
 .     vertical = vertical, align = cl.align.text)
</code></pre>
<p><img src="output_343_1.png" alt="png"></p>
<p>和其他独立的绘图函数一样，corrplot()有很多自己的选项。这里列出一些最有用的选项。  </p>
<p><code>type = c("full", "lower", "upper")</code>全部，仅使用下三角或上三角<br><code>diag = TRUE</code>是否显示对角线上的数值<br><code>method = "shade"</code>  使用颜色方块图形<br><code>method = "ellipse"</code>使用椭圆图形<br><code>addCoef.col="color"</code>  在图形上添加相关系数的颜色<br><code>tl.srt = number</code>设定图形上方文本标签的倾斜角度<br><code>tl.col = "color"</code>设定文本标签颜色<br><code>order = c("AOE", "FPC", "hclust")</code>矩阵重排序，使用特征值角排序、第一主成分或层次聚类</p>
<h2 id="绘制函数曲线"><a href="#绘制函数曲线" class="headerlink" title="绘制函数曲线"></a>绘制函数曲线</h2><p>使用<code>stat_function()</code>函数。为了得到合适的x的范围，必须给<code>ggplot()</code>函数传递一个“哑”数据集。在本例中，使用正态分布的密度函数<code>dnorm()</code>来演示。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p &lt;- ggplot(data.frame(x=c(-3,3)), aes(x=x))

p + stat_function(fun = dnorm)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_347_0.png" alt="png"></p>
<p>某些函数需要设定额外的参数，比如t分布的密度函数<code>dt()</code>就需要一个参数来设定自由度。可以这样来设定额外的参数：把参数放到一个列表中，再传给 args 参数</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + stat_function(fun = dt, args = list(df=2))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p><img src="output_349_0.png" alt="png"></p>
<p>也可以绘制自定义的函数。其中第一个参数必须是x轴的值，并且必须返回y轴的值。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">myfun &lt;- function(xvar) {
    1 / (1 + exp(-xvar + 10))
}

ggplot(data.frame(x=c(0,20)), aes(x=x))  + stat_function(fun=myfun)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_351_0.png" alt="png"></p>
<p>计算函数值时默认使用给出的x范围内的101个点。想增加点数，使得曲线更平滑，可以给<code>stat_function()</code>传递一个更大的n，比如<code>stat_function(fun=myfun, n=200)</code></p>
<h2 id="在函数曲线下添加阴影"><a href="#在函数曲线下添加阴影" class="headerlink" title="在函数曲线下添加阴影"></a>在函数曲线下添加阴影</h2><p>根据你的曲线函数定义一个新的函数。</p>
<h2 id="如何绘制热图"><a href="#如何绘制热图" class="headerlink" title="如何绘制热图"></a>如何绘制热图</h2><p>使用<code>geom_title()</code>或者<code>geom_raster()</code>，并将一个连续变量映射到fill上。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">presidents
# 时间序列对象 而不是数据框<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A Time Series: 30 × 4</caption>
<thead>
    <tr><th></th><th scope="col">Qtr1</th><th scope="col">Qtr2</th><th scope="col">Qtr3</th><th scope="col">Qtr4</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1945</th><td>NA</td><td>87</td><td>82</td><td>75</td></tr>
    <tr><th scope="row">1946</th><td>63</td><td>50</td><td>43</td><td>32</td></tr>
    <tr><th scope="row">1947</th><td>35</td><td>60</td><td>54</td><td>55</td></tr>
    <tr><th scope="row">1948</th><td>36</td><td>39</td><td>NA</td><td>NA</td></tr>
    <tr><th scope="row">1949</th><td>69</td><td>57</td><td>57</td><td>51</td></tr>
    <tr><th scope="row">1950</th><td>45</td><td>37</td><td>46</td><td>39</td></tr>
    <tr><th scope="row">1951</th><td>36</td><td>24</td><td>32</td><td>23</td></tr>
    <tr><th scope="row">1952</th><td>25</td><td>32</td><td>NA</td><td>32</td></tr>
    <tr><th scope="row">1953</th><td>59</td><td>74</td><td>75</td><td>60</td></tr>
    <tr><th scope="row">1954</th><td>71</td><td>61</td><td>71</td><td>57</td></tr>
    <tr><th scope="row">1955</th><td>71</td><td>68</td><td>79</td><td>73</td></tr>
    <tr><th scope="row">1956</th><td>76</td><td>71</td><td>67</td><td>75</td></tr>
    <tr><th scope="row">1957</th><td>79</td><td>62</td><td>63</td><td>57</td></tr>
    <tr><th scope="row">1958</th><td>60</td><td>49</td><td>48</td><td>52</td></tr>
    <tr><th scope="row">1959</th><td>57</td><td>62</td><td>61</td><td>66</td></tr>
    <tr><th scope="row">1960</th><td>71</td><td>62</td><td>61</td><td>57</td></tr>
    <tr><th scope="row">1961</th><td>72</td><td>83</td><td>71</td><td>78</td></tr>
    <tr><th scope="row">1962</th><td>79</td><td>71</td><td>62</td><td>74</td></tr>
    <tr><th scope="row">1963</th><td>76</td><td>64</td><td>62</td><td>57</td></tr>
    <tr><th scope="row">1964</th><td>80</td><td>73</td><td>69</td><td>69</td></tr>
    <tr><th scope="row">1965</th><td>71</td><td>64</td><td>69</td><td>62</td></tr>
    <tr><th scope="row">1966</th><td>63</td><td>46</td><td>56</td><td>44</td></tr>
    <tr><th scope="row">1967</th><td>44</td><td>52</td><td>38</td><td>46</td></tr>
    <tr><th scope="row">1968</th><td>36</td><td>49</td><td>35</td><td>44</td></tr>
    <tr><th scope="row">1969</th><td>59</td><td>65</td><td>65</td><td>56</td></tr>
    <tr><th scope="row">1970</th><td>66</td><td>53</td><td>61</td><td>52</td></tr>
    <tr><th scope="row">1971</th><td>51</td><td>48</td><td>54</td><td>49</td></tr>
    <tr><th scope="row">1972</th><td>49</td><td>61</td><td>NA</td><td>NA</td></tr>
    <tr><th scope="row">1973</th><td>68</td><td>44</td><td>40</td><td>27</td></tr>
    <tr><th scope="row">1974</th><td>28</td><td>25</td><td>24</td><td>24</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">str(presidents)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre><code> Time-Series [1:120] from 1945 to 1975: NA 87 82 75 63 50 43 32 35 60 ...
</code></pre>
<p>首先将它转化为<code>ggplot()</code>可用的数据框格式，其中的列都是数值形式的。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">pres_rating &lt;- data.frame(
    rating  = as.numeric(presidents),
    year    = as.numeric(floor(time(presidents))),
    quarter = as.numeric(cycle(presidents))
)

pres_rating<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 120 × 3</caption>
<thead>
    <tr><th scope="col">rating</th><th scope="col">year</th><th scope="col">quarter</th></tr>
    <tr><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>NA</td><td>1945</td><td>1</td></tr>
    <tr><td>87</td><td>1945</td><td>2</td></tr>
    <tr><td>82</td><td>1945</td><td>3</td></tr>
    <tr><td>75</td><td>1945</td><td>4</td></tr>
    <tr><td>63</td><td>1946</td><td>1</td></tr>
    <tr><td>50</td><td>1946</td><td>2</td></tr>
    <tr><td>43</td><td>1946</td><td>3</td></tr>
    <tr><td>32</td><td>1946</td><td>4</td></tr>
    <tr><td>35</td><td>1947</td><td>1</td></tr>
    <tr><td>60</td><td>1947</td><td>2</td></tr>
    <tr><td>54</td><td>1947</td><td>3</td></tr>
    <tr><td>55</td><td>1947</td><td>4</td></tr>
    <tr><td>36</td><td>1948</td><td>1</td></tr>
    <tr><td>39</td><td>1948</td><td>2</td></tr>
    <tr><td>NA</td><td>1948</td><td>3</td></tr>
    <tr><td>NA</td><td>1948</td><td>4</td></tr>
    <tr><td>69</td><td>1949</td><td>1</td></tr>
    <tr><td>57</td><td>1949</td><td>2</td></tr>
    <tr><td>57</td><td>1949</td><td>3</td></tr>
    <tr><td>51</td><td>1949</td><td>4</td></tr>
    <tr><td>45</td><td>1950</td><td>1</td></tr>
    <tr><td>37</td><td>1950</td><td>2</td></tr>
    <tr><td>46</td><td>1950</td><td>3</td></tr>
    <tr><td>39</td><td>1950</td><td>4</td></tr>
    <tr><td>36</td><td>1951</td><td>1</td></tr>
    <tr><td>24</td><td>1951</td><td>2</td></tr>
    <tr><td>32</td><td>1951</td><td>3</td></tr>
    <tr><td>23</td><td>1951</td><td>4</td></tr>
    <tr><td>25</td><td>1952</td><td>1</td></tr>
    <tr><td>32</td><td>1952</td><td>2</td></tr>
    <tr><td>...</td><td>...</td><td>...</td></tr>
    <tr><td>38</td><td>1967</td><td>3</td></tr>
    <tr><td>46</td><td>1967</td><td>4</td></tr>
    <tr><td>36</td><td>1968</td><td>1</td></tr>
    <tr><td>49</td><td>1968</td><td>2</td></tr>
    <tr><td>35</td><td>1968</td><td>3</td></tr>
    <tr><td>44</td><td>1968</td><td>4</td></tr>
    <tr><td>59</td><td>1969</td><td>1</td></tr>
    <tr><td>65</td><td>1969</td><td>2</td></tr>
    <tr><td>65</td><td>1969</td><td>3</td></tr>
    <tr><td>56</td><td>1969</td><td>4</td></tr>
    <tr><td>66</td><td>1970</td><td>1</td></tr>
    <tr><td>53</td><td>1970</td><td>2</td></tr>
    <tr><td>61</td><td>1970</td><td>3</td></tr>
    <tr><td>52</td><td>1970</td><td>4</td></tr>
    <tr><td>51</td><td>1971</td><td>1</td></tr>
    <tr><td>48</td><td>1971</td><td>2</td></tr>
    <tr><td>54</td><td>1971</td><td>3</td></tr>
    <tr><td>49</td><td>1971</td><td>4</td></tr>
    <tr><td>49</td><td>1972</td><td>1</td></tr>
    <tr><td>61</td><td>1972</td><td>2</td></tr>
    <tr><td>NA</td><td>1972</td><td>3</td></tr>
    <tr><td>NA</td><td>1972</td><td>4</td></tr>
    <tr><td>68</td><td>1973</td><td>1</td></tr>
    <tr><td>44</td><td>1973</td><td>2</td></tr>
    <tr><td>40</td><td>1973</td><td>3</td></tr>
    <tr><td>27</td><td>1973</td><td>4</td></tr>
    <tr><td>28</td><td>1974</td><td>1</td></tr>
    <tr><td>25</td><td>1974</td><td>2</td></tr>
    <tr><td>24</td><td>1974</td><td>3</td></tr>
    <tr><td>24</td><td>1974</td><td>4</td></tr>
</tbody>
</table>



<p>现在我们可以使用<code>geom_title()</code>或<code>gem_raster()</code>来绘图。简单地将几个变量分别映射到x, y 和 fill：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">options(repr.plot.height=4 ,repr.plot.width=8)
# 基础图形
p &lt;- ggplot(pres_rating, aes(x=year, y=quarter, fill=rating))

# 使用geom_title()
p + geom_tile()

# 使用 geom_raster()看起来一样，但效率略低
p + geom_raster()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_362_0.png" alt="png"></p>
<p><img src="output_362_1.png" alt="png"></p>
<p>为了更有效地表达信息，可能需要自定义热图地外观。在本例中，倒转y轴，这样顺序就是从上到下，并且在x轴上，每隔4年添加一个坐标刻度来表示一个总统任期。此外，更换之前的颜色标度，使用scale_fill_graadient2()调色盘，该调色盘可以设置一个中点和两个端点的色彩值：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">p + geom_tile() + 
 scale_x_continuous(breaks = seq(1940, 1976, by=4)) +
 scale_y_reverse() + 
 scale_fill_gradient2(midpoint = 50, mid = 'grey70', limits=c(0,100))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_364_0.png" alt="png"></p>
<h2 id="绘制三维散点图"><a href="#绘制三维散点图" class="headerlink" title="绘制三维散点图"></a>绘制三维散点图</h2><p>使用rgl包，该包提供了OpenGL图形库的3D绘图接口。要画三维散点图，可以使用<code>plot3d()</code>函数。其输入参数可以是两种形式：（1）一个数据框，前三列分别表示x、y、z；（2）直接传递三个向量，分别表示x、y、z的坐标。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(rgl)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre><code>Warning message:
"package 'rgl' was built under R version 4.0.5"
</code></pre>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">plot3d(mtcars$wt, mtcars$disp, mtcars$mpg, type="s", size=.75, lit=FALSE)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="绘制QQ图"><a href="#绘制QQ图" class="headerlink" title="绘制QQ图"></a>绘制QQ图</h2><p>❓如何绘制QQ图来比较经验分布和理论分布？  </p>
<p>💡使用<code>qqnorm()</code>和正态分布比较。给<code>qqnorm()</code>一个数值向量，在此基础上用<code>qqline()</code>加上理论分布。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># height的QQ图
qqnorm(heightweight$heightIn)
qqline(heightweight$heightIn)

# age的QQ图
qqnorm(heightweight$ageYear)
qqline(heightweight$ageYear)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_371_0.png" alt="png"></p>
<p><img src="output_371_1.png" alt="png"></p>
<p>heightIn 的 点很接近理论线，这意味着它的分布很接近正态分布。相反，ageYear的点远离理论线，特别是在左面，这表明是有偏离的。此外，直方图在探索数据的分布上也是有帮助的。</p>
<h2 id="绘制经验累积分布函数"><a href="#绘制经验累积分布函数" class="headerlink" title="绘制经验累积分布函数"></a>绘制经验累积分布函数</h2><p>❓如何画一个数据集的经验累积分布函数图（ECDF）?<br>💡使用stat_ecdf():</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># heightIn 的 ecdf
ggplot(heightweight, aes(x=heightIn)) + stat_ecdf()

# ageYear的 ecdf
ggplot(heightweight, aes(x=ageYear)) + stat_ecdf()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_375_0.png" alt="png"></p>
<p><img src="output_375_1.png" alt="png"></p>
<p>ecdf表明了在观测数据中，小于或等于给定x值的观测所占的比例。因为是经验的，所以累积分布线在每个有观测值的x值处产生一个阶梯。</p>
<h1 id="第十四章-输出图形用以展示"><a href="#第十四章-输出图形用以展示" class="headerlink" title="第十四章 输出图形用以展示"></a>第十四章 输出图形用以展示</h1><h2 id="输出为PDF矢量文件"><a href="#输出为PDF矢量文件" class="headerlink" title="输出为PDF矢量文件"></a>输出为PDF矢量文件</h2><p>最常用的方法是使用 <code>pdf()</code>打开PDF图形设备，绘制图形，然后使用<code>dev.off()</code>关闭图形设备。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># width 和 height 的单位是 英寸： 1cm = 2.54英寸
pdf('myplot.pdf', width=4, height=4)

# 绘制图形
plot(mtcars$wt, mtcars$mpg)
print(ggplot(mtcars, aes(x=wt, y=mpg)) + geom_point())

dev.off()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><strong>png:</strong> 2</p>
<p>如果绘制的图形多于一副，则每一页将在PDF输出中列于独立的一页。<br>❗注意，使用<code>print()</code>，确保即使是一段脚本也能输出图形。</p>
<p>如果在创建图形过程中抛出一个错误，R无法执行到<code>dev.off()</code>这一步调用，并可能停留在PDF设备仍然开启的状态。当这种情况发生时，直到手动调用<code>dev.off()</code>之前，PDF文件将无法正常打开。</p>
<p>用ggplot创建图形，使用ggsave()会简单一点，但它只会保存最后一幅图形。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(mtcars, aes(x=wt, y=mpg)) + geom_point()

# 默认为英寸单位，不过也可指定
ggsave('myplot-ggsave.pdf', width = 8, height = 8, units = 'cm')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_384_0.png" alt="png"></p>
<h2 id="在PDF文件中使用字体"><a href="#在PDF文件中使用字体" class="headerlink" title="在PDF文件中使用字体"></a>在PDF文件中使用字体</h2><p>如何在PDF文件中使用由R提供的基本字体以外的字体？</p>
<p>💡 extrafont包可用于创建包含其他字体的PDF文件。<br>需要一次性的软件安装和配置。<br>下载并安装Ghostscript，然后再R中执行以下命令。  </p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">install.packages('extrafont')
library(extrafont)

# 查找并保存系统中已安装字体的信息
font_import()

# 列出字体
fonts()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="第十五章-数据塑形"><a href="#第十五章-数据塑形" class="headerlink" title="第十五章 数据塑形"></a>第十五章 数据塑形</h1><p>想深入学习数据处理，建议前往&lt;R数据科学&gt;进行深度学习</p>
<p>R中数据集常以数据框的形式存在。它们都是典型的二维数据结构，每行代表一个具体对象（case,object），每行代表一个描述对象的变量。<br>数据框本质上是由向量和因子组成的列表，其中每个向量或者因子代表了数据的一列。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(gcookbook)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre><code>Warning message:
"package 'gcookbook' was built under R version 4.0.3"
</code></pre>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(heightweight,2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 5</caption>
<thead>
    <tr><th></th><th scope="col">sex</th><th scope="col">ageYear</th><th scope="col">ageMonth</th><th scope="col">heightIn</th><th scope="col">weightLb</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>f</td><td>11.92</td><td>143</td><td>56.3</td><td> 85</td></tr>
    <tr><th scope="row">2</th><td>f</td><td>12.92</td><td>155</td><td>62.3</td><td>105</td></tr>
</tbody>
</table>



<p>使用<code>str()</code>函数了解数据结构</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">str(heightweight)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre><code>'data.frame':    236 obs. of  5 variables:
 $ sex     : Factor w/ 2 levels "f","m": 1 1 1 1 1 1 1 1 1 1 ...
 $ ageYear : num  11.9 12.9 12.8 13.4 15.9 ...
 $ ageMonth: int  143 155 153 161 191 171 185 142 160 140 ...
 $ heightIn: num  56.3 62.3 63.3 59 62.5 62.5 59 56.5 62 53.8 ...
 $ weightLb: num  85 105 108 92 112 ...
</code></pre>
<p>数据第一列 sex ，是一个两水平(“f” 和 “m”)的因子，其余四列都是数值型向量（其中ageMonth是整型向量，但在此处，它与其他数值向量并无明显区别）。</p>
<h2 id="创建数据框"><a href="#创建数据框" class="headerlink" title="创建数据框"></a>创建数据框</h2><p>如何将若干向量组织成数据框</p>
<p>💡可以把向量放在<code>data.frame()</code>里面：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 从两个简单的向量开始
g &lt;- c('A','B','C')
x &lt;- 1:3
gf &lt;- as.factor(g)
dat &lt;- data.frame(g,x,gf)
dat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 3 × 3</caption>
<thead>
    <tr><th scope="col">g</th><th scope="col">x</th><th scope="col">gf</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
    <tr><td>A</td><td>1</td><td>A</td></tr>
    <tr><td>B</td><td>2</td><td>B</td></tr>
    <tr><td>C</td><td>3</td><td>C</td></tr>
</tbody>
</table>



<p>如果向量在一个列表当中，可以用<code>as.data.frame()</code>函数直接将它们转化成数据框：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">lst &lt;- list(group = g, value = x, groupfactor = gf)
dat &lt;- as.data.frame(lst)
dat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 3 × 3</caption>
<thead>
    <tr><th scope="col">group</th><th scope="col">value</th><th scope="col">groupfactor</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
    <tr><td>A</td><td>1</td><td>A</td></tr>
    <tr><td>B</td><td>2</td><td>B</td></tr>
    <tr><td>C</td><td>3</td><td>C</td></tr>
</tbody>
</table>



<h2 id="从数据框中提取信息"><a href="#从数据框中提取信息" class="headerlink" title="从数据框中提取信息"></a>从数据框中提取信息</h2><p><code>str()</code>函数在提取数据框更多信息的时候很实用。一个常见问题是，有时候一个数据框包含的向量是字符型向量而不是因子，反之亦然。这个问题会在分析和画图的时候给我们造成一些困扰。</p>
<p>在Rstudio里面，在提示符(&gt;)后面输入数据框的名称，然后敲下回车键。不会显示每列数据的类型。只有通过<code>str()</code>函数，才能看出它们的区别。<br>在jupyter中，输出数据框，每列名称下面会标注数据类型。</p>
<p><img src="attachment:da47d489-5b86-4024-8e45-f3ffba956a34.png" alt="image.png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">str(dat)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre><code>'data.frame':    3 obs. of  3 variables:
 $ group      : chr  "A" "B" "C"
 $ value      : int  1 2 3
 $ groupfactor: Factor w/ 3 levels "A","B","C": 1 2 3
</code></pre>
<h2 id="向数据框添加列"><a href="#向数据框添加列" class="headerlink" title="向数据框添加列"></a>向数据框添加列</h2><p>💡只需把值赋到新列即可：</p>
<p>如果把单个值赋到新列，整个列都将是这个值。下面的例子是增加一个新列，值全都是NA</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">dat$newcol &lt;- NA<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="从数据框中删除一列"><a href="#从数据框中删除一列" class="headerlink" title="从数据框中删除一列"></a>从数据框中删除一列</h2><p>💡把该列的值赋为 NULL 即可</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">dat$group &lt;- NULL
dat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 3 × 3</caption>
<thead>
    <tr><th scope="col">value</th><th scope="col">groupfactor</th><th scope="col">newcol</th></tr>
    <tr><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;lgl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>1</td><td>A</td><td>NA</td></tr>
    <tr><td>2</td><td>B</td><td>NA</td></tr>
    <tr><td>3</td><td>C</td><td>NA</td></tr>
</tbody>
</table>



<p>也可以用subset()函数并将一个**<code>-</code>**（减号）置于待删除的列之前：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 返回不包含barcol列的数据
dat &lt;- subset(dat, select = -value)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 排除多列
dat &lt;- subset(dat, select = c(-groupfactor, -newcol))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="重命名数据框的列名"><a href="#重命名数据框的列名" class="headerlink" title="重命名数据框的列名"></a>重命名数据框的列名</h2><p>💡使用<code>names(dat) &lt;-</code> 或者 <code>colnames(dat) &lt;-</code>函数即可：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">names(dat) &lt;- c('name1', 'name2', 'name3')<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如果你想通过列名，重命名某一列：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(gcookbook) 
names(anthoming)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'angle'</li><li>'expt'</li><li>'ctrl'</li></ol>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">names(anthoming)[names(anthoming)=='ctrl'] &lt;- c('Control')
names(anthoming)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'angle'</li><li>'expt'</li><li>'Control'</li></ol>



<p>也可以通过名字的数值位置重命名：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">colnames(anthoming)[1] &lt;- 'Angle'
colnames(anthoming)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'Angle'</li><li>'expt'</li><li>'Control'</li></ol>



<h2 id="重排序数据框的列"><a href="#重排序数据框的列" class="headerlink" title="重排序数据框的列"></a>重排序数据框的列</h2><p>💡通过列的 <strong>数值位置</strong> 或者 <strong>名称</strong> 重排序</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(gcookbook)
anthoming<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 5 × 3</caption>
<thead>
    <tr><th scope="col">Angle</th><th scope="col">expt</th><th scope="col">Control</th></tr>
    <tr><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>-20</td><td>1</td><td>0</td></tr>
    <tr><td>-10</td><td>7</td><td>3</td></tr>
    <tr><td>  0</td><td>2</td><td>3</td></tr>
    <tr><td> 10</td><td>0</td><td>3</td></tr>
    <tr><td> 20</td><td>0</td><td>1</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 列表风格的索引
anthoming[c(1,3,2)]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 5 × 3</caption>
<thead>
    <tr><th scope="col">Angle</th><th scope="col">Control</th><th scope="col">expt</th></tr>
    <tr><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>-20</td><td>0</td><td>1</td></tr>
    <tr><td>-10</td><td>3</td><td>7</td></tr>
    <tr><td>  0</td><td>3</td><td>2</td></tr>
    <tr><td> 10</td><td>3</td><td>0</td></tr>
    <tr><td> 20</td><td>1</td><td>0</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 矩阵风格的索引
anthoming[,c(1,3,2)] # 逗号之前的空白表示输出所有行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 5 × 3</caption>
<thead>
    <tr><th scope="col">Angle</th><th scope="col">Control</th><th scope="col">expt</th></tr>
    <tr><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>-20</td><td>0</td><td>1</td></tr>
    <tr><td>-10</td><td>3</td><td>7</td></tr>
    <tr><td>  0</td><td>3</td><td>2</td></tr>
    <tr><td> 10</td><td>3</td><td>0</td></tr>
    <tr><td> 20</td><td>1</td><td>0</td></tr>
</tbody>
</table>



<p>这种情况下，两种方法都会得到数据框。<br>❗然而，当你单独检索一列的时候，列表风格的索引会得到数据框，而矩阵风格的索引得到的是向量，除非你加上参数<code>drop=FALSE</code>:</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">str(anthoming[3]) # 列表风格的索引<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre><code>'data.frame':    5 obs. of  1 variable:
 $ Control: int  0 3 3 3 1
</code></pre>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">str(anthoming[,3]) # 矩阵风格的索引， 获得向量<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre><code> int [1:5] 0 3 3 3 1
</code></pre>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">str(anthoming[,3, drop = FALSE]) # 矩阵风格的索引，并添加参数 drop=FALSE, 获得数据框<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre><code>'data.frame':    5 obs. of  1 variable:
 $ Control: int  0 3 3 3 1
</code></pre>
<h2 id="从数据框提取子集"><a href="#从数据框提取子集" class="headerlink" title="从数据框提取子集"></a>从数据框提取子集</h2><p>使用<code>subset()</code>函数。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(gcookbook)
str(climate)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre><code>'data.frame':    499 obs. of  6 variables:
 $ Source    : chr  "Berkeley" "Berkeley" "Berkeley" "Berkeley" ...
 $ Year      : num  1800 1801 1802 1803 1804 ...
 $ Anomaly1y : num  NA NA NA NA NA NA NA NA NA NA ...
 $ Anomaly5y : num  NA NA NA NA NA NA NA NA NA NA ...
 $ Anomaly10y: num  -0.435 -0.453 -0.46 -0.493 -0.536 -0.541 -0.59 -0.695 -0.763 -0.818 ...
 $ Unc10y    : num  0.505 0.493 0.486 0.489 0.483 0.475 0.468 0.461 0.453 0.451 ...
</code></pre>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 选取 Source 是 Berkeley 的行，并且选取名字为 Year 和 Anomaly10y 的列
climate.berkeley &lt;- subset(climate, Source=='Berkeley', select = c(Year, Anomaly10y))
head(climate.berkeley,2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 2</caption>
<thead>
    <tr><th></th><th scope="col">Year</th><th scope="col">Anomaly10y</th></tr>
    <tr><th></th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>1800</td><td>-0.435</td></tr>
    <tr><th scope="row">2</th><td>1801</td><td>-0.453</td></tr>
</tbody>
</table>



<p>还可以通过使用 <strong><code>|</code></strong> (<strong>OR</strong>) 和 <strong><code>&amp;</code></strong> (<strong>AND</strong>)操作符同时施加多种筛选条件。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">climate.berkeley.hundred &lt;- subset(climate, Source=='Berkeley' &amp; Year&gt;=1900 &amp; Year&lt;=2000, select = c(Year, Anomaly10y))
head(climate.berkeley.hundred, 2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 2</caption>
<thead>
    <tr><th></th><th scope="col">Year</th><th scope="col">Anomaly10y</th></tr>
    <tr><th></th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">101</th><td>1900</td><td>-0.171</td></tr>
    <tr><th scope="row">102</th><td>1901</td><td>-0.162</td></tr>
</tbody>
</table>



<p>也可以在方括号内加入索引来得到子数据框，虽然这种方法不是很优雅。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 逗号后面的部分提取列
climate.indexsub&lt;- climate[ climate$Source=='Berkeley' &amp; climate$Year &gt;= 1900 &amp; climate$Year &lt;=2000, c('Year', 'Anomaly10y')]
head(climate.indexsub,2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 2</caption>
<thead>
    <tr><th></th><th scope="col">Year</th><th scope="col">Anomaly10y</th></tr>
    <tr><th></th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">101</th><td>1900</td><td>-0.171</td></tr>
    <tr><th scope="row">102</th><td>1901</td><td>-0.162</td></tr>
</tbody>
</table>



<p>如果用这种方式得到的结果<u>只有一列</u>，那么它会返回一个向量而不是数据框，除非使用参数 <code>drop=FALSE</code>:</p>
<p>最后，还可以通过行和列的数值位置提取子数据框。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 不建议使用数据索引，可读性不好
climate.indexpos &lt;- subset(climate[1:100, c(2,5)])<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="改变因子水平的顺序"><a href="#改变因子水平的顺序" class="headerlink" title="改变因子水平的顺序"></a>改变因子水平的顺序</h2><p>💡因子的水平可以由函数<code>factor()</code>具体设定。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 默认的因子水平的顺序是按字母排列的
sizes &lt;- factor(c('small','large','large','small','medium'))
sizes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>small</li><li>large</li><li>large</li><li>small</li><li>medium</li></ol>

<details>
    <summary style="display:list-item;cursor:pointer">
        <strong>Levels</strong>:
    </summary>
    <style>
    .list-inline {list-style: none; margin:0; padding: 0}
    .list-inline>li {display: inline-block}
    .list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
    </style>
    <ol class="list-inline"><li>'large'</li><li>'medium'</li><li>'small'</li></ol>
</details>



<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 改变因子水平的顺序
sizes &lt;- factor(sizes, levels = c('small', 'medium', 'large'))
sizes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>small</li><li>large</li><li>large</li><li>small</li><li>medium</li></ol>

<details>
    <summary style="display:list-item;cursor:pointer">
        <strong>Levels</strong>:
    </summary>
    <style>
    .list-inline {list-style: none; margin:0; padding: 0}
    .list-inline>li {display: inline-block}
    .list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
    </style>
    <ol class="list-inline"><li>'small'</li><li>'medium'</li><li>'large'</li></ol>
</details>


<p>因子的顺序也可以在第一次创建因子时通过levels参数来指定</p>
<p>💬R中有两种因子：顺序因子（order factor）和常规因子（regulator factor）。在两种类型中，因子水平都是按照某种顺序排列的；区别在于，对于顺序因子，因子水平的顺序是有意义的，而对于常规因子，因子水平的顺序却没有什么意义。</p>
<p>在ggplot2绘图过程中，因子变量被映射到图形属性中，图形属性会采用因子水平的顺序。如 x 轴，x 轴标签会按因子水平的顺序排列。</p>
<p>如果要颠倒因子水平的顺序，可以使用函数 rev(levels()):</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">factor(sizes, levels = rev(levels(sizes)))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>small</li><li>large</li><li>large</li><li>small</li><li>medium</li></ol>

<details>
    <summary style="display:list-item;cursor:pointer">
        <strong>Levels</strong>:
    </summary>
    <style>
    .list-inline {list-style: none; margin:0; padding: 0}
    .list-inline>li {display: inline-block}
    .list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
    </style>
    <ol class="list-inline"><li>'large'</li><li>'medium'</li><li>'small'</li></ol>
</details>


<h2 id="根据数据的值改变因子水平的顺序"><a href="#根据数据的值改变因子水平的顺序" class="headerlink" title="根据数据的值改变因子水平的顺序"></a>根据数据的值改变因子水平的顺序</h2><p>💡使用函数<code>reorder()</code>，该函数有三个参数：因子，排序依据的数据（以哪一列做排序依据）, 汇总数据的函数（操作数据方法）。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 复制一份数据，因为我们要修改它
iss &lt;- InsectSprays
iss$spray<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li></ol>

<details>
    <summary style="display:list-item;cursor:pointer">
        <strong>Levels</strong>:
    </summary>
    <style>
    .list-inline {list-style: none; margin:0; padding: 0}
    .list-inline>li {display: inline-block}
    .list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
    </style>
    <ol class="list-inline"><li>'A'</li><li>'B'</li><li>'C'</li><li>'D'</li><li>'E'</li><li>'F'</li></ol>
</details>



<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(iss,2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 2</caption>
<thead>
    <tr><th></th><th scope="col">count</th><th scope="col">spray</th></tr>
    <tr><th></th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>10</td><td>A</td></tr>
    <tr><th scope="row">2</th><td> 7</td><td>A</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">iss$spray &lt;- reorder(iss$spray, iss$count, FUN = mean)
iss$spray<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li></ol>

<details>
    <summary style="display:list-item;cursor:pointer">
        <strong>Levels</strong>:
    </summary>
    <style>
    .list-inline {list-style: none; margin:0; padding: 0}
    .list-inline>li {display: inline-block}
    .list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
    </style>
    <ol class="list-inline"><li>'C'</li><li>'E'</li><li>'D'</li><li>'A'</li><li>'B'</li><li>'F'</li></ol>
</details>


<p>起始因子水平的顺序是ABCDEF，重排后的顺序是CEDABF。新的顺序是由 iss$spray 中每组 iss$count 的平均值决定的。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(data = iss, aes(x=spray,y=count)) + 
 geom_boxplot() + 
 theme_bw(base_size = 25)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_461_0.png" alt="png"></p>
<p>注意到这些中位值并不是严格按照从左到右依次递增的顺序的，于是在<code>reorder()</code>函数中应用 median() 函数</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">iss$spray &lt;- reorder(iss$spray, iss$count, FUN = median)
iss$spray<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>A</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>B</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>C</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>D</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>E</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li><li>F</li></ol>

<details>
    <summary style="display:list-item;cursor:pointer">
        <strong>Levels</strong>:
    </summary>
    <style>
    .list-inline {list-style: none; margin:0; padding: 0}
    .list-inline>li {display: inline-block}
    .list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
    </style>
    <ol class="list-inline"><li>'C'</li><li>'E'</li><li>'D'</li><li>'A'</li><li>'F'</li><li>'B'</li></ol>
</details>



<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 以 count 的 median 进行排序
ggplot(data = iss, aes(x=spray,y=count)) + 
 geom_boxplot() + 
 theme_bw(base_size = 25)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_464_0.png" alt="png"></p>
<h2 id="改变因子水平的名称"><a href="#改变因子水平的名称" class="headerlink" title="改变因子水平的名称"></a>改变因子水平的名称</h2><p>使用 plyr包中的<code>revalue()</code>函数或<code>mapvalues()</code>函数。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">levels(sizes)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'small'</li><li>'medium'</li><li>'large'</li></ol>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(plyr)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">sizes1 &lt;- revalue(sizes, c(small="S", medium="M", large="L"))
sizes1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>S</li><li>L</li><li>L</li><li>S</li><li>M</li></ol>

<details>
    <summary style="display:list-item;cursor:pointer">
        <strong>Levels</strong>:
    </summary>
    <style>
    .list-inline {list-style: none; margin:0; padding: 0}
    .list-inline>li {display: inline-block}
    .list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
    </style>
    <ol class="list-inline"><li>'S'</li><li>'M'</li><li>'L'</li></ol>
</details>



<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 也可以使用引号——如果原因子水平名称中存在空格等特殊字符，这将很有用
revalue(sizes, c("small"="S", "medium"='M', "large"="L"))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>S</li><li>L</li><li>L</li><li>S</li><li>M</li></ol>

<details>
    <summary style="display:list-item;cursor:pointer">
        <strong>Levels</strong>:
    </summary>
    <style>
    .list-inline {list-style: none; margin:0; padding: 0}
    .list-inline>li {display: inline-block}
    .list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
    </style>
    <ol class="list-inline"><li>'S'</li><li>'M'</li><li>'L'</li></ol>
</details>



<pre class="line-numbers language-R" data-language="R"><code class="language-R"># mapvalues()函数使用两组向量，而不是一组映射关系向量
mapvalues(sizes, c("small", "medium", "large"), c("S","M","L"))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>S</li><li>L</li><li>L</li><li>S</li><li>M</li></ol>

<details>
    <summary style="display:list-item;cursor:pointer">
        <strong>Levels</strong>:
    </summary>
    <style>
    .list-inline {list-style: none; margin:0; padding: 0}
    .list-inline>li {display: inline-block}
    .list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
    </style>
    <ol class="list-inline"><li>'S'</li><li>'M'</li><li>'L'</li></ol>
</details>


<p>revalue()函数和mapvalues()函数很方便，但是在R中有一个更传统（也更笨）的方法，使用<code>levels() &lt;- </code>函数</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">sizes &lt;- factor(c('small','large','large','small','medium'))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">levels(sizes)[levels(sizes)=='large'] &lt;- 'L'
levels(sizes)[levels(sizes)=='medium'] &lt;- 'M'
levels(sizes)[levels(sizes)=='small'] &lt;- 'S'
sizes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>S</li><li>L</li><li>L</li><li>S</li><li>M</li></ol>

<details>
    <summary style="display:list-item;cursor:pointer">
        <strong>Levels</strong>:
    </summary>
    <style>
    .list-inline {list-style: none; margin:0; padding: 0}
    .list-inline>li {display: inline-block}
    .list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
    </style>
    <ol class="list-inline"><li>'L'</li><li>'M'</li><li>'S'</li></ol>
</details>


<p>如果你要改变所有水平的名称，这里有一个更简单的方法。可以给 levels() 传递一个 list 类型的参数:</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">sizes &lt;- factor(c('small','large','large','small','medium'))
levels(sizes) &lt;- list(S='small', M='medium', L='large')
sizes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>S</li><li>L</li><li>L</li><li>S</li><li>M</li></ol>

<details>
    <summary style="display:list-item;cursor:pointer">
        <strong>Levels</strong>:
    </summary>
    <style>
    .list-inline {list-style: none; margin:0; padding: 0}
    .list-inline>li {display: inline-block}
    .list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
    </style>
    <ol class="list-inline"><li>'S'</li><li>'M'</li><li>'L'</li></ol>
</details>


<p>在这个方法中，所有因子必须在一个<code>list</code>里面指定；如果<code>list</code>里面有任何的缺失，缺失的值最终会以<code>NA</code>代替</p>
<h2 id="去掉因子中不再使用的水平"><a href="#去掉因子中不再使用的水平" class="headerlink" title="去掉因子中不再使用的水平"></a>去掉因子中不再使用的水平</h2><p>使用 <code>droplevels()</code> 函数</p>
<h2 id="把一个分类变量转化为另一个分类变量"><a href="#把一个分类变量转化为另一个分类变量" class="headerlink" title="把一个分类变量转化为另一个分类变量"></a>把一个分类变量转化为另一个分类变量</h2><p>使用PlantGrowth数据集的一个子数据集</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">pg &lt;- PlantGrowth[c(1,2,11,21,22),]
pg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 5 × 2</caption>
<thead>
    <tr><th></th><th scope="col">weight</th><th scope="col">group</th></tr>
    <tr><th></th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>4.17</td><td>ctrl</td></tr>
    <tr><th scope="row">2</th><td>5.58</td><td>ctrl</td></tr>
    <tr><th scope="row">11</th><td>4.81</td><td>trt1</td></tr>
    <tr><th scope="row">21</th><td>6.31</td><td>trt2</td></tr>
    <tr><th scope="row">22</th><td>5.12</td><td>trt2</td></tr>
</tbody>
</table>



<p>在这个例子中，使用<code>cut()</code>函数把一个连续变量weight转化为分类变量wtclass</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">pg$wtclass &lt;- cut(pg$weight, breaks = c(0,2,6,Inf))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">pg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 5 × 3</caption>
<thead>
    <tr><th></th><th scope="col">weight</th><th scope="col">group</th><th scope="col">wtclass</th></tr>
    <tr><th></th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>4.17</td><td>ctrl</td><td>(2,6]  </td></tr>
    <tr><th scope="row">2</th><td>5.58</td><td>ctrl</td><td>(2,6]  </td></tr>
    <tr><th scope="row">11</th><td>4.81</td><td>trt1</td><td>(2,6]  </td></tr>
    <tr><th scope="row">21</th><td>6.31</td><td>trt2</td><td>(6,Inf]</td></tr>
    <tr><th scope="row">22</th><td>5.12</td><td>trt2</td><td>(2,6]  </td></tr>
</tbody>
</table>



<p>💬我们为三个类设定了四个边界，边界值可以包括无穷<code>Inf</code>.如果一个值落在了规定区间外，它的类别将被定为NA（缺失值）。<code>cut()</code>函数的输出结果是一个因子，可以从下面这个例子看出：因子水平的名称是以生成的区间命名的。</p>
<p>为了改变因子水平的名称，可以使用cut()中的labels参数</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">pg$wtclass &lt;- cut(pg$weight, breaks = c(0,5,6,Inf), labels = c('small', 'medium', 'large'))
pg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 5 × 3</caption>
<thead>
    <tr><th></th><th scope="col">weight</th><th scope="col">group</th><th scope="col">wtclass</th></tr>
    <tr><th></th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>4.17</td><td>ctrl</td><td>small </td></tr>
    <tr><th scope="row">2</th><td>5.58</td><td>ctrl</td><td>medium</td></tr>
    <tr><th scope="row">11</th><td>4.81</td><td>trt1</td><td>small </td></tr>
    <tr><th scope="row">21</th><td>6.31</td><td>trt2</td><td>large </td></tr>
    <tr><th scope="row">22</th><td>5.12</td><td>trt2</td><td>medium</td></tr>
</tbody>
</table>



<p>cut生成的区间是左开右闭的。可以通过设置 <code>include.lowest=TRUE</code>使得它同时包含最小值和最大值。如果想让区间是左闭右开的，设定参数<code>right=FALSE</code>:</p>
<h2 id="变量转换"><a href="#变量转换" class="headerlink" title="变量转换"></a>变量转换</h2><p>可以使用<code>$</code>操作符来引用新列并对齐赋予新值。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(gcookbook)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">hw &lt;- heightweight
head(hw,2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 5</caption>
<thead>
    <tr><th></th><th scope="col">sex</th><th scope="col">ageYear</th><th scope="col">ageMonth</th><th scope="col">heightIn</th><th scope="col">weightLb</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>f</td><td>11.92</td><td>143</td><td>56.3</td><td> 85</td></tr>
    <tr><th scope="row">2</th><td>f</td><td>12.92</td><td>155</td><td>62.3</td><td>105</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">hw$heighCm &lt;- hw$heightIn * 22.54<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>💬为了使代码更容易阅读，可以使用<code>transform()</code>或plyr包中的<code>mutate()</code>函数。<br>只需指定数据框一次，将其作为函数的第一个参数；它们提供了非常清晰的语法，尤其适合转换多个变量：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">hw &lt;- transform(hw, heightCm = heightIn * 2.54, weightKg = weightLb / 2.204)
head(hw,1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 1 × 8</caption>
<thead>
    <tr><th></th><th scope="col">sex</th><th scope="col">ageYear</th><th scope="col">ageMonth</th><th scope="col">heightIn</th><th scope="col">weightLb</th><th scope="col">heighCm</th><th scope="col">heightCm</th><th scope="col">weightKg</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>f</td><td>11.92</td><td>143</td><td>56.3</td><td>85</td><td>1269.002</td><td>143.002</td><td>38.56624</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(dplyr)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre><code>Warning message:
"package 'dplyr' was built under R version 4.0.5"

Attaching package: 'dplyr'


The following objects are masked from 'package:plyr':

    arrange, count, desc, failwith, id, mutate, rename, summarise,
    summarize


The following objects are masked from 'package:stats':

    filter, lag


The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union
</code></pre>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">hw &lt;- mutate(hw, heightCm = heightIn * 2.54, weightKg = weightLb / 2.204)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>也可以根据多个变量产生一个新的变量：</p>
<p>transform() 和 mutate() 函数的最大区别是 transform() 会同时计算所有的新列，而 mutate() 将依次计算新列，这样在计算新列时，就可以依赖之前的新列。由于bmi是由 heightCm 和 weightKg 计算来的，因此用 transform() 不能同时计算这些变量；先算得到 heightCm 和 weightKg ，再计算 bmi。而 mutate 可以一次完成计算。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">hw &lt;- mutate(hw,
       heightCm = heightIn * 2.54,
       weightKg = weightLb / 2.204,
       bmi = weightKg / (heightCm / 100)^2
)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(hw,2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 9</caption>
<thead>
    <tr><th></th><th scope="col">sex</th><th scope="col">ageYear</th><th scope="col">ageMonth</th><th scope="col">heightIn</th><th scope="col">weightLb</th><th scope="col">heighCm</th><th scope="col">heightCm</th><th scope="col">weightKg</th><th scope="col">bmi</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>f</td><td>11.92</td><td>143</td><td>56.3</td><td> 85</td><td>1269.002</td><td>143.002</td><td>38.56624</td><td>18.85919</td></tr>
    <tr><th scope="row">2</th><td>f</td><td>12.92</td><td>155</td><td>62.3</td><td>105</td><td>1404.242</td><td>158.242</td><td>47.64065</td><td>19.02542</td></tr>
</tbody>
</table>



<h2 id="按组转换数据"><a href="#按组转换数据" class="headerlink" title="按组转换数据"></a>按组转换数据</h2><p>💡使用 plyr 包中的 ddply() 函数，在参数中调用 transform()，并指定运算：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(MASS)
library(dplyr)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre><code>Warning message:
"package 'MASS' was built under R version 4.0.5"

Attaching package: 'MASS'


The following object is masked from 'package:dplyr':

    select
</code></pre>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(cabbages,2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 4</caption>
<thead>
    <tr><th></th><th scope="col">Cult</th><th scope="col">Date</th><th scope="col">HeadWt</th><th scope="col">VitC</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>c39</td><td>d16</td><td>2.5</td><td>51</td></tr>
    <tr><th scope="row">2</th><td>c39</td><td>d16</td><td>2.2</td><td>55</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">cb &lt;- ddply(cabbages, "Cult", transform, DevWt = HeadWt - mean(HeadWt))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(cb,2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 5</caption>
<thead>
    <tr><th></th><th scope="col">Cult</th><th scope="col">Date</th><th scope="col">HeadWt</th><th scope="col">VitC</th><th scope="col">DevWt</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>c39</td><td>d16</td><td>2.5</td><td>51</td><td>-0.4066667</td></tr>
    <tr><th scope="row">2</th><td>c39</td><td>d16</td><td>2.2</td><td>55</td><td>-0.7066667</td></tr>
</tbody>
</table>



<p>上面的代码首先会将cabbages数据根据Cult分割成几个独立的数据框。 Cult 上有两个水平，c39 和 c52, 因此也就是分割成两个。然后在这两个数据框上使用 <code>transform()</code> 函数，其他参数保持不变。</p>
<p>也可以根据多个变量分组、切割数据框，同时也可以在多个变量上进行运算。本例中将会根据 Cult 和 Date 切割数据，形成两者组合得到的分组，然后计算 HeadWt 和 VitC 在各个组的偏差：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">cb &lt;- ddply(cabbages, c('Cult','Date'), transform,
     DevWt = HeadWt - mean(HeadWt), DevVitC = VitC - mean(VitC))
head(cb,2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 6</caption>
<thead>
    <tr><th></th><th scope="col">Cult</th><th scope="col">Date</th><th scope="col">HeadWt</th><th scope="col">VitC</th><th scope="col">DevWt</th><th scope="col">DevVitC</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>c39</td><td>d16</td><td>2.5</td><td>51</td><td>-0.68</td><td>0.7</td></tr>
    <tr><th scope="row">2</th><td>c39</td><td>d16</td><td>2.2</td><td>55</td><td>-0.98</td><td>4.7</td></tr>
</tbody>
</table>



<h2 id="分组汇总数据"><a href="#分组汇总数据" class="headerlink" title="分组汇总数据"></a>分组汇总数据</h2><p>配合 summarise() 函数使用 plyr 包中的 <code>ddply()</code> 函数，并指定操作为 summarise</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(MASS)
library(plyr)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">ddply(cabbages, c("Cult", "Date"), summarise, Weight = mean(HeadWt),
     VitC = mean(VitC))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 6 × 4</caption>
<thead>
    <tr><th scope="col">Cult</th><th scope="col">Date</th><th scope="col">Weight</th><th scope="col">VitC</th></tr>
    <tr><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>c39</td><td>d16</td><td>3.18</td><td>50.3</td></tr>
    <tr><td>c39</td><td>d20</td><td>2.80</td><td>49.4</td></tr>
    <tr><td>c39</td><td>d21</td><td>2.74</td><td>54.8</td></tr>
    <tr><td>c52</td><td>d16</td><td>2.26</td><td>62.5</td></tr>
    <tr><td>c52</td><td>d20</td><td>3.11</td><td>58.9</td></tr>
    <tr><td>c52</td><td>d21</td><td>1.47</td><td>71.8</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">summarise(cabbages, Weight = mean(HeadWt))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 1 × 1</caption>
<thead>
    <tr><th scope="col">Weight</th></tr>
    <tr><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>2.593333</td></tr>
</tbody>
</table>



<p><code>summarise()</code>计算均值会更合适，得到一行一列的数据框，名为 Weight。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ddply(cabbages, 'Cult', summarise, Weight = mean(HeadWt))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 2</caption>
<thead>
    <tr><th scope="col">Cult</th><th scope="col">Weight</th></tr>
    <tr><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>c39</td><td>2.906667</td></tr>
    <tr><td>c52</td><td>2.280000</td></tr>
</tbody>
</table>



<p>上面的代码首先根据 Cult 的值将数据框 cabbages 切割成了几个小数据框。因子 Cult 有两个水平，c39和c52，因此也就有两个数据框，然后在每个数据框上套用 <code>summarise()</code>，利用 <code>mean()</code> 函数计算每个数据框中 HeadWt 的均值并赋给新的列 Weight。结果就得到了两个一行的数据框，然后 ddply() 将它们合并为一个。</p>
<p>除了求均值，我们还可以做很多其他的事。比方说，你可能想计算每个组的标准差和频数；使用 sd() 来计算标准差， length() 来计算频数</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">colnames(cabbages)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'Cult'</li><li>'Date'</li><li>'HeadWt'</li><li>'VitC'</li></ol>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">ddply(cabbages, c('Cult','Date'), summarise, Weight = mean(HeadWt),sd = sd(HeadWt), n = length(HeadWt))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 6 × 5</caption>
<thead>
    <tr><th scope="col">Cult</th><th scope="col">Date</th><th scope="col">Weight</th><th scope="col">sd</th><th scope="col">n</th></tr>
    <tr><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>c39</td><td>d16</td><td>3.18</td><td>0.9566144</td><td>10</td></tr>
    <tr><td>c39</td><td>d20</td><td>2.80</td><td>0.2788867</td><td>10</td></tr>
    <tr><td>c39</td><td>d21</td><td>2.74</td><td>0.9834181</td><td>10</td></tr>
    <tr><td>c52</td><td>d16</td><td>2.26</td><td>0.4452215</td><td>10</td></tr>
    <tr><td>c52</td><td>d20</td><td>3.11</td><td>0.7908505</td><td>10</td></tr>
    <tr><td>c52</td><td>d21</td><td>1.47</td><td>0.2110819</td><td>10</td></tr>
</tbody>
</table>



<p>还有一些有用的函数也能够得到汇总统计量，包括 min(), max(), median() 等</p>
<h3 id="处理缺失值"><a href="#处理缺失值" class="headerlink" title="处理缺失值"></a>处理缺失值</h3><p>首先试一下会发生什么</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">c1 &lt;- cabbages
c1$HeadWt[c(1,20,45)] &lt;- NA<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">ddply(c1, c('Cult','Date'), summarise,
     Weight = mean(HeadWt),
     sd = sd(HeadWt),
     n = length(HeadWt))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 6 × 5</caption>
<thead>
    <tr><th scope="col">Cult</th><th scope="col">Date</th><th scope="col">Weight</th><th scope="col">sd</th><th scope="col">n</th></tr>
    <tr><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>c39</td><td>d16</td><td>  NA</td><td>       NA</td><td>10</td></tr>
    <tr><td>c39</td><td>d20</td><td>  NA</td><td>       NA</td><td>10</td></tr>
    <tr><td>c39</td><td>d21</td><td>2.74</td><td>0.9834181</td><td>10</td></tr>
    <tr><td>c52</td><td>d16</td><td>2.26</td><td>0.4452215</td><td>10</td></tr>
    <tr><td>c52</td><td>d20</td><td>  NA</td><td>       NA</td><td>10</td></tr>
    <tr><td>c52</td><td>d21</td><td>1.47</td><td>0.2110819</td><td>10</td></tr>
</tbody>
</table>



<p>两个问题。<br>第一个问题：如果任一输入值包含NA，mean() 和 sd()函数都会返回NA。幸运的是，这些函数都有一个参数来处理这个问题：设置 na.rm=TRUE即可忽略缺失值。</p>
<p>第二个问题：<code>length()</code>没有对缺失值进行特殊处理，而是将它们视为正常值，但这是不对的。可以使用<code>sum(!is.na(...))</code>达到相同的效果。 <code>is.na()</code> 返回一个逻辑向量：NA返回TRUE，非NA返回TRUE。用 ! 取反后，再用 <code>sum()</code> 函数将TRUE的数量加起来。最终的结果就是非缺失值的频数：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ddply(c1, c('Cult','Date'), summarise,
     Weight = mean(HeadWt, na.rm = TRUE),
     sd = sd(HeadWt, na.rm = TRUE),
     n = sum(!is.na(HeadWt)))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 6 × 5</caption>
<thead>
    <tr><th scope="col">Cult</th><th scope="col">Date</th><th scope="col">Weight</th><th scope="col">sd</th><th scope="col">n</th></tr>
    <tr><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>c39</td><td>d16</td><td>3.255556</td><td>0.9824855</td><td> 9</td></tr>
    <tr><td>c39</td><td>d20</td><td>2.722222</td><td>0.1394433</td><td> 9</td></tr>
    <tr><td>c39</td><td>d21</td><td>2.740000</td><td>0.9834181</td><td>10</td></tr>
    <tr><td>c52</td><td>d16</td><td>2.260000</td><td>0.4452215</td><td>10</td></tr>
    <tr><td>c52</td><td>d20</td><td>3.044444</td><td>0.8094923</td><td> 9</td></tr>
    <tr><td>c52</td><td>d21</td><td>1.470000</td><td>0.2110819</td><td>10</td></tr>
</tbody>
</table>



<h3 id="组合缺失"><a href="#组合缺失" class="headerlink" title="组合缺失"></a>组合缺失</h3><p>如果在分类变量中有任何‘空组合’，它们就不会出现在汇总的数据框中。缺失组合会给绘图带来麻烦。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 复制 cabbages 并移除同时包含c52和d21的行
c2 &lt;- subset(c1, !(Cult=='c52' &amp; Date=='d21'))

c2a &lt;- ddply(c2, c('Cult','Date'), summarise,
     Weight = mean(HeadWt, na.rm = TRUE),
     sd = sd(HeadWt, na.rm = TRUE),
     n = sum(!is.na(HeadWt)))
c2a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 5 × 5</caption>
<thead>
    <tr><th scope="col">Cult</th><th scope="col">Date</th><th scope="col">Weight</th><th scope="col">sd</th><th scope="col">n</th></tr>
    <tr><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>c39</td><td>d16</td><td>3.255556</td><td>0.9824855</td><td> 9</td></tr>
    <tr><td>c39</td><td>d20</td><td>2.722222</td><td>0.1394433</td><td> 9</td></tr>
    <tr><td>c39</td><td>d21</td><td>2.740000</td><td>0.9834181</td><td>10</td></tr>
    <tr><td>c52</td><td>d16</td><td>2.260000</td><td>0.4452215</td><td>10</td></tr>
    <tr><td>c52</td><td>d20</td><td>3.044444</td><td>0.8094923</td><td> 9</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(c2a, aes(x=Date, y=Weight, fill=Cult)) + 
 geom_bar(stat='identity', position = position_dodge()) + 
 theme_bw(base_size = 25)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p><img src="output_533_0.png" alt="png"></p>
<p>为了填充缺失的组合，在ddply() 函数中使用 <code>.drop=FALSE</code>即可：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">c2b &lt;- ddply(c2, c('Cult','Date'), .drop = FALSE, summarise,
     Weight = mean(HeadWt, na.rm = TRUE),
     sd = sd(HeadWt, na.rm = TRUE),
     n = sum(!is.na(HeadWt)))
c2b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 6 × 5</caption>
<thead>
    <tr><th scope="col">Cult</th><th scope="col">Date</th><th scope="col">Weight</th><th scope="col">sd</th><th scope="col">n</th></tr>
    <tr><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>c39</td><td>d16</td><td>3.255556</td><td>0.9824855</td><td> 9</td></tr>
    <tr><td>c39</td><td>d20</td><td>2.722222</td><td>0.1394433</td><td> 9</td></tr>
    <tr><td>c39</td><td>d21</td><td>2.740000</td><td>0.9834181</td><td>10</td></tr>
    <tr><td>c52</td><td>d16</td><td>2.260000</td><td>0.4452215</td><td>10</td></tr>
    <tr><td>c52</td><td>d20</td><td>3.044444</td><td>0.8094923</td><td> 9</td></tr>
    <tr><td>c52</td><td>d21</td><td>     NaN</td><td>       NA</td><td> 0</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(c2b, aes(x=Date, y=Weight, fill=Cult)) + 
 geom_bar(stat='identity', position = position_dodge()) + 
 theme_bw(base_size = 25)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre><code>Warning message:
"Removed 1 rows containing missing values (geom_bar)."
</code></pre>
<p><img src="output_536_1.png" alt="png"></p>
<h2 id="使用标准误差和置信区间来汇总数据"><a href="#使用标准误差和置信区间来汇总数据" class="headerlink" title="使用标准误差和置信区间来汇总数据"></a>使用标准误差和置信区间来汇总数据</h2><pre class="line-numbers language-R" data-language="R"><code class="language-R">ca &lt;- ddply(cabbages, c('Cult', 'Date'), summarise,
     Weight = mean(HeadWt, na.rm = TRUE), 
     sd = sd(HeadWt, na.rm = TRUE),
     n = sum(!is.na(HeadWt)),
     se = sd / sqrt(n))
ca<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 6 × 6</caption>
<thead>
    <tr><th scope="col">Cult</th><th scope="col">Date</th><th scope="col">Weight</th><th scope="col">sd</th><th scope="col">n</th><th scope="col">se</th></tr>
    <tr><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>c39</td><td>d16</td><td>3.18</td><td>0.9566144</td><td>10</td><td>0.30250803</td></tr>
    <tr><td>c39</td><td>d20</td><td>2.80</td><td>0.2788867</td><td>10</td><td>0.08819171</td></tr>
    <tr><td>c39</td><td>d21</td><td>2.74</td><td>0.9834181</td><td>10</td><td>0.31098410</td></tr>
    <tr><td>c52</td><td>d16</td><td>2.26</td><td>0.4452215</td><td>10</td><td>0.14079141</td></tr>
    <tr><td>c52</td><td>d20</td><td>3.11</td><td>0.7908505</td><td>10</td><td>0.25008887</td></tr>
    <tr><td>c52</td><td>d21</td><td>1.47</td><td>0.2110819</td><td>10</td><td>0.06674995</td></tr>
</tbody>
</table>



<p>计算均值的标准差包括两步：首先计算各组的标准差和频数，然后用这些值来计算得到标准误差。各组的标准误差就是标准差除以样本量的平方根。</p>
<h2 id="置信区间"><a href="#置信区间" class="headerlink" title="置信区间"></a>置信区间</h2><p>置信区间是通过均值的标准误差和自由度计算得到的。要计算置信区间，首先使用<code>qt()</code>得到分位数，然后和标准误差相乘即可。<br>给定概率值和自由度，<code>qt()</code> 函数会计算出对应t分布的分位数。<br>对95%的置信区间来说，应该使用0.975的概率值；对钟形的t分布，这对应了曲线两端各2.5%的面积。自由度是样本量大小减去1.</p>
<p>下面的代码将会计算每组标准误差的乘数。由于一共有6个组，并且每个组都有10个观测值，因此它们会有相同的乘数。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ciMult &lt;- qt(.975, ca$n-1)
ciMult<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>2.2621571627982</li><li>2.2621571627982</li><li>2.2621571627982</li><li>2.2621571627982</li><li>2.2621571627982</li><li>2.2621571627982</li></ol>



<p>现在我们将上面的向量乘以标准误差来得到95%的置信区间：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ca$ci &lt;- ca$se * ciMult<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">ca<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 6 × 7</caption>
<thead>
    <tr><th scope="col">Cult</th><th scope="col">Date</th><th scope="col">Weight</th><th scope="col">sd</th><th scope="col">n</th><th scope="col">se</th><th scope="col">ci</th></tr>
    <tr><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>c39</td><td>d16</td><td>3.18</td><td>0.9566144</td><td>10</td><td>0.30250803</td><td>0.6843207</td></tr>
    <tr><td>c39</td><td>d20</td><td>2.80</td><td>0.2788867</td><td>10</td><td>0.08819171</td><td>0.1995035</td></tr>
    <tr><td>c39</td><td>d21</td><td>2.74</td><td>0.9834181</td><td>10</td><td>0.31098410</td><td>0.7034949</td></tr>
    <tr><td>c52</td><td>d16</td><td>2.26</td><td>0.4452215</td><td>10</td><td>0.14079141</td><td>0.3184923</td></tr>
    <tr><td>c52</td><td>d20</td><td>3.11</td><td>0.7908505</td><td>10</td><td>0.25008887</td><td>0.5657403</td></tr>
    <tr><td>c52</td><td>d21</td><td>1.47</td><td>0.2110819</td><td>10</td><td>0.06674995</td><td>0.1509989</td></tr>
</tbody>
</table>



<p>误差条表示均值的标准误差，它和置信区间有相同的功能：估计总体均值的好坏程度。<br>标准误差是抽样分布的标准差</p>
<h2 id="把数据从“宽”变“长”"><a href="#把数据从“宽”变“长”" class="headerlink" title="把数据从“宽”变“长”"></a>把数据从“宽”变“长”</h2><p>💡使用 reshape2 包中的 <code>melt()</code> 函数。在 anthoming 数据集中，angle 表示蚂蚁行进方向与家的方向的角度，实验组（expt）、对照组（ctrl）的数值表示在两组中蚂蚁的数量。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(gcookbook)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">anthoming<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 5 × 3</caption>
<thead>
    <tr><th scope="col">Angle</th><th scope="col">expt</th><th scope="col">Control</th></tr>
    <tr><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>-20</td><td>1</td><td>0</td></tr>
    <tr><td>-10</td><td>7</td><td>3</td></tr>
    <tr><td>  0</td><td>2</td><td>3</td></tr>
    <tr><td> 10</td><td>0</td><td>3</td></tr>
    <tr><td> 20</td><td>0</td><td>1</td></tr>
</tbody>
</table>



<p>为了得到便于分析绘图的数据结果，对以上数据进行结构重塑</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(reshape2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 'Angle' 为 标识变量， 'expt' 和 'control' 为非标识变量，这里两个非标识变量都成为了度量变量，汇成了 condition 的一部分。
melt(anthoming, id.vars = 'Angle', variable.name = 'condition', value.name = 'count')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 10 × 3</caption>
<thead>
    <tr><th scope="col">Angle</th><th scope="col">condition</th><th scope="col">count</th></tr>
    <tr><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>-20</td><td>expt   </td><td>1</td></tr>
    <tr><td>-10</td><td>expt   </td><td>7</td></tr>
    <tr><td>  0</td><td>expt   </td><td>2</td></tr>
    <tr><td> 10</td><td>expt   </td><td>0</td></tr>
    <tr><td> 20</td><td>expt   </td><td>0</td></tr>
    <tr><td>-20</td><td>Control</td><td>0</td></tr>
    <tr><td>-10</td><td>Control</td><td>3</td></tr>
    <tr><td>  0</td><td>Control</td><td>3</td></tr>
    <tr><td> 10</td><td>Control</td><td>3</td></tr>
    <tr><td> 20</td><td>Control</td><td>1</td></tr>
</tbody>
</table>



<p>如果不想用所有的非标识变量(如上的 ‘expt’ 和 ‘control’)作为度量变量，可以指明哪些变量是你需要的(使用 measure.vars)。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">drunk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 6</caption>
<thead>
    <tr><th scope="col">sex</th><th scope="col">0-29</th><th scope="col">30-39</th><th scope="col">40-49</th><th scope="col">50-59</th><th scope="col">60+</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>male  </td><td>185</td><td>207</td><td>260</td><td>180</td><td>71</td></tr>
    <tr><td>female</td><td>  4</td><td> 13</td><td> 10</td><td>  7</td><td>10</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">melt(drunk, id.vars = 'sex', measure.vars = c('0-29','30-39'), variable.name = 'age', value.name = 'count')<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 4 × 3</caption>
<thead>
    <tr><th scope="col">sex</th><th scope="col">age</th><th scope="col">count</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>male  </td><td>0-29 </td><td>185</td></tr>
    <tr><td>female</td><td>0-29 </td><td>  4</td></tr>
    <tr><td>male  </td><td>30-39</td><td>207</td></tr>
    <tr><td>female</td><td>30-39</td><td> 13</td></tr>
</tbody>
</table>



<p>同时，也可以用多列作为标识度量：</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">plum_wide<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 4 × 4</caption>
<thead>
    <tr><th scope="col">length</th><th scope="col">time</th><th scope="col">dead</th><th scope="col">alive</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>long </td><td>at_once  </td><td> 84</td><td>156</td></tr>
    <tr><td>long </td><td>in_spring</td><td>156</td><td> 84</td></tr>
    <tr><td>short</td><td>at_once  </td><td>133</td><td>107</td></tr>
    <tr><td>short</td><td>in_spring</td><td>209</td><td> 31</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">melt(plum_wide, id.vars = c('length', 'time'), variable.name = 'survival', value.name = 'count')<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 8 × 4</caption>
<thead>
    <tr><th scope="col">length</th><th scope="col">time</th><th scope="col">survival</th><th scope="col">count</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>long </td><td>at_once  </td><td>dead </td><td> 84</td></tr>
    <tr><td>long </td><td>in_spring</td><td>dead </td><td>156</td></tr>
    <tr><td>short</td><td>at_once  </td><td>dead </td><td>133</td></tr>
    <tr><td>short</td><td>in_spring</td><td>dead </td><td>209</td></tr>
    <tr><td>long </td><td>at_once  </td><td>alive</td><td>156</td></tr>
    <tr><td>long </td><td>in_spring</td><td>alive</td><td> 84</td></tr>
    <tr><td>short</td><td>at_once  </td><td>alive</td><td>107</td></tr>
    <tr><td>short</td><td>in_spring</td><td>alive</td><td> 31</td></tr>
</tbody>
</table>



<p>有些数据集并不具备标识变量。这种情况中，可以在用 <code>melt()</code> 函数之前，给这个数据框添加一个标识变量。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">co &lt;- corneas
co<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 8 × 2</caption>
<thead>
    <tr><th scope="col">affected</th><th scope="col">notaffected</th></tr>
    <tr><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>488</td><td>484</td></tr>
    <tr><td>478</td><td>478</td></tr>
    <tr><td>480</td><td>492</td></tr>
    <tr><td>426</td><td>444</td></tr>
    <tr><td>440</td><td>436</td></tr>
    <tr><td>410</td><td>398</td></tr>
    <tr><td>458</td><td>464</td></tr>
    <tr><td>460</td><td>476</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R"># 添加标识列
co$id &lt;- as.character(1:nrow(co)) # 用数值做标识列，在后续分析中很可能会出问题，所以 用 as.character() 函数或者 用 factor() 转化一下<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">melt(co, id.vars = 'id', variable.name = 'eye', value.name = 'count')<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 16 × 3</caption>
<thead>
    <tr><th scope="col">id</th><th scope="col">eye</th><th scope="col">count</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>1</td><td>affected   </td><td>488</td></tr>
    <tr><td>2</td><td>affected   </td><td>478</td></tr>
    <tr><td>3</td><td>affected   </td><td>480</td></tr>
    <tr><td>4</td><td>affected   </td><td>426</td></tr>
    <tr><td>5</td><td>affected   </td><td>440</td></tr>
    <tr><td>6</td><td>affected   </td><td>410</td></tr>
    <tr><td>7</td><td>affected   </td><td>458</td></tr>
    <tr><td>8</td><td>affected   </td><td>460</td></tr>
    <tr><td>1</td><td>notaffected</td><td>484</td></tr>
    <tr><td>2</td><td>notaffected</td><td>478</td></tr>
    <tr><td>3</td><td>notaffected</td><td>492</td></tr>
    <tr><td>4</td><td>notaffected</td><td>444</td></tr>
    <tr><td>5</td><td>notaffected</td><td>436</td></tr>
    <tr><td>6</td><td>notaffected</td><td>398</td></tr>
    <tr><td>7</td><td>notaffected</td><td>464</td></tr>
    <tr><td>8</td><td>notaffected</td><td>476</td></tr>
</tbody>
</table>



<h2 id="把数据框从“长”到宽"><a href="#把数据框从“长”到宽" class="headerlink" title="把数据框从“长”到宽"></a>把数据框从“长”到宽</h2><p>使用 reshape2 包中的 dcast() 函数。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(gcookbook)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">plum<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 8 × 4</caption>
<thead>
    <tr><th scope="col">length</th><th scope="col">time</th><th scope="col">survival</th><th scope="col">count</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>long </td><td>at_once  </td><td>dead </td><td> 84</td></tr>
    <tr><td>long </td><td>in_spring</td><td>dead </td><td>156</td></tr>
    <tr><td>short</td><td>at_once  </td><td>dead </td><td>133</td></tr>
    <tr><td>short</td><td>in_spring</td><td>dead </td><td>209</td></tr>
    <tr><td>long </td><td>at_once  </td><td>alive</td><td>156</td></tr>
    <tr><td>long </td><td>in_spring</td><td>alive</td><td> 84</td></tr>
    <tr><td>short</td><td>at_once  </td><td>alive</td><td>107</td></tr>
    <tr><td>short</td><td>in_spring</td><td>alive</td><td> 31</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(reshape2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R"># ~ 左侧为标识变量， 右边表示可变变量
dcast(plum, length + time ~ survival, value.var = 'count')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 4 × 4</caption>
<thead>
    <tr><th scope="col">length</th><th scope="col">time</th><th scope="col">dead</th><th scope="col">alive</th></tr>
    <tr><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th></tr>
</thead>
<tbody>
    <tr><td>long </td><td>at_once  </td><td> 84</td><td>156</td></tr>
    <tr><td>long </td><td>in_spring</td><td>156</td><td> 84</td></tr>
    <tr><td>short</td><td>at_once  </td><td>133</td><td>107</td></tr>
    <tr><td>short</td><td>in_spring</td><td>209</td><td> 31</td></tr>
</tbody>
</table>

<h1 id="在ggplot2图形上添加显著性差异注释"><a href="#在ggplot2图形上添加显著性差异注释" class="headerlink" title="在ggplot2图形上添加显著性差异注释"></a>在ggplot2图形上添加显著性差异注释</h1><p>参考资料:<br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1692505">如何在ggplot2图形上添加显著性差异注释</a></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(ggsignif)
library(ggplot2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">data(iris)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<pre class="line-numbers language-R" data-language="R"><code class="language-R">head(iris,2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<table class="dataframe">
<caption>A data.frame: 2 × 5</caption>
<thead>
    <tr><th></th><th scope="col">Sepal.Length</th><th scope="col">Sepal.Width</th><th scope="col">Petal.Length</th><th scope="col">Petal.Width</th><th scope="col">Species</th></tr>
    <tr><th></th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>5.1</td><td>3.5</td><td>1.4</td><td>0.2</td><td>setosa</td></tr>
    <tr><th scope="row">2</th><td>4.9</td><td>3.0</td><td>1.4</td><td>0.2</td><td>setosa</td></tr>
</tbody>
</table>




<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(iris, aes(x=Species, y=Sepal.Length)) + 
 geom_boxplot() +
 theme_bw(base_size = 25) +
 theme(panel.grid = element_blank()) +
 geom_signif(comparisons = list(c("setosa", "versicolor"),
                                 c("setosa", "virginica"),
                                 c("versicolor", "virginica")),
              y_position=c(7.5, 8.5, 8.2), 
              tip_length = c(0.2, 0.05, 0.2, 0.05, 0.1, 0.05),
              map_signif_level=TRUE,
              textsize=8)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><img src="output_578_0.png" alt="png"></p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">ggplot(dat, aes(Group, Value)) +
  geom_bar(aes(fill = Sub), stat="identity", position="dodge", width=.5) +
  geom_signif(y_position=c(6.0, 8.5), xmin=c(0.85, 1.85), xmax=c(1.15, 2.15),
              annotation=c("**", "NS"), tip_length=0.04) + 
  geom_signif(comparisons=list(c("S1", "S2")),
              y_position = 9.3, tip_length = 0.04, vjust=0.2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre><code>1. ggplot(dat, aes(Group, Value))
</code></pre>
<h2 id="参数解释"><a href="#参数解释" class="headerlink" title="参数解释"></a>参数解释</h2><p>mapping # 由aes()或aes_()创建的美学映射集。如果指定且inherit.aes=TRUE（默认值），它将与绘图顶层的默认映射结合。如果没有绘图映射，则必须提供映射。<br>data # 绘图数据所在的数据框<br>position # 位置调整；可以是字符串，也可以是位置调整函数的结果<br>na.rm # 逻辑词，默认为FALSE，移除缺失值时显示警告信息，为TRUE，则不显示警告信息。<br>show.legend # 逻辑词，是否显示图例<br>comparisons # 长度为2的向量列表<br>test # 进行统计检验的方法名称，如t.test、wilcox.test、aov()、anova()、kruskal.test() 等。<br>test.args # 检验方法的其他参数<br>annotations # 替换P值注释的字符向量<br>map_signif_level # 布尔值，检验结果P值使用注释或者星号代替<br>y_position # 括号线在对齐y轴高度的数字向量<br>xmin # 括号线左侧位置的数字向量<br>xmax # 括号线右侧位置的数字向量<br>step_increase # 数字向量，减少括号线的重叠<br>tip_length # 数字向量，显示括号线两端的下降的小竖线，用来指向精确的组别<br>size # 设置括号线的宽度<br>textsize # 设置文本字体大小<br>family # 设置文本字体<br>vjust # 相对于括号线，上下调整文本的距离<br>parse # 逻辑词，为TRUE，则标签将解析为表达式  </p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">梁绍波</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://liangshaw.github.io/2022/01/02/RDataVisualization-2/">https://liangshaw.github.io/2022/01/02/RDataVisualization-2/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">梁绍波</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/R/">
                                    <span class="chip bg-color">R</span>
                                </a>
                            
                                <a href="/tags/ggplot2/">
                                    <span class="chip bg-color">ggplot2</span>
                                </a>
                            
                                <a href="/tags/handbook/">
                                    <span class="chip bg-color">handbook</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,douban" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'QweMbL6pJuEjzHeRLcd4sxIW-gzGzoHsz',
        appKey: 'JdA69Wq6tDpDu1DWdKmY4DJy',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'retro',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '请留下友善的评论~'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/01/02/Git_instructions/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/10.jpg" class="responsive-img" alt="git/github basic usage guide">
                        
                        <span class="card-title">git/github basic usage guide</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            一些 git 常用命令，用作备忘录、使用手册，方便快速查阅
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-01-02
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            梁绍波
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/git/">
                        <span class="chip bg-color">git</span>
                    </a>
                    
                    <a href="/tags/Github/">
                        <span class="chip bg-color">Github</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/01/02/RDataVisualization-1/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/18.jpg" class="responsive-img" alt="R数据可视化手册-上">
                        
                        <span class="card-title">R数据可视化手册-上</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            博主最开始正式学习 R 语言的时候，是出于数据可视化的目的，以 Oreilly 的《R数据可视化手册》 为 handbook，将此书的 90% 内容在 jupyter 中都复现了一遍。jupyter 原始文件可到我的 Github 相应仓库中获取。由于内容较多，分为了上下两部分。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-01-02
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/R%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E6%89%8B%E5%86%8C/" class="post-category">
                                    R数据可视化手册
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/R/">
                        <span class="chip bg-color">R</span>
                    </a>
                    
                    <a href="/tags/ggplot2/">
                        <span class="chip bg-color">ggplot2</span>
                    </a>
                    
                    <a href="/tags/handbook/">
                        <span class="chip bg-color">handbook</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Shaw<br />'
            + '文章作者: 梁绍波<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4, h5, h6'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5, h6').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022-2023</span>
            
            <a href="/about" target="_blank">梁绍波</a>
            |&nbsp;版权所有
            |&nbsp;Theme Source&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            <i class="fas fa-chart-area"></i>&nbsp;
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2022";
                        var startMonth = "1";
                        var startDate = "1";
                        var startHour = "0";
                        var startMinute = "0";
                        var startSecond = "0";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/LiangShaw" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:shaoboliang@whu.edu.cn" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1323909095" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1323909095" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
